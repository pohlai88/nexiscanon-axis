{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "escalation-ladder",
  "type": "registry:block",
  "title": "Escalation Ladder (AFANDA)",
  "description": "Automatic escalation paths with SLA timers, contact methods, and manual escalation triggers",
  "categories": [
    "afanda",
    "collaboration",
    "escalation"
  ],
  "registryDependencies": [
    "card",
    "button",
    "badge",
    "tooltip"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/afanda/escalation-ladder.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Escalation Ladder - AFANDA Platform Component\n *\n * Automatic escalation visualization and management.\n * Implements A01-CANONICAL.md §8 — AFANDA (Accountability)\n *\n * Features:\n * - Visual escalation path\n * - SLA countdown at each level\n * - Current escalation status\n * - Manual escalation option\n * - Escalation history\n *\n * @example\n * ```tsx\n * import { EscalationLadder } from \"@workspace/design-system\"\n *\n * <EscalationLadder\n *   item={pendingItem}\n *   levels={escalationLevels}\n *   onManualEscalate={(level) => escalateToLevel(level)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Avatar } from \"@/components/avatar\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  ArrowUp,\n  Clock,\n  CheckCircle,\n  AlertTriangle,\n  User,\n  Mail,\n  Phone,\n  ChevronUp,\n  Loader2,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type EscalationStatus = \"pending\" | \"active\" | \"completed\" | \"skipped\"\n\nexport interface EscalationContact {\n  id: string\n  name: string\n  role: string\n  email?: string\n  phone?: string\n  avatarUrl?: string\n}\n\nexport interface EscalationLevel {\n  level: number\n  name: string\n  description?: string\n  contact: EscalationContact\n  slaHours: number\n  status: EscalationStatus\n  activatedAt?: string | Date\n  completedAt?: string | Date\n  notifiedAt?: string | Date\n}\n\nexport interface EscalationItem {\n  id: string\n  title: string\n  description?: string\n  priority: \"low\" | \"normal\" | \"high\" | \"urgent\"\n  createdAt: string | Date\n  currentLevel: number\n}\n\nexport interface EscalationLadderProps {\n  /** Item being escalated */\n  item: EscalationItem\n  /** Escalation levels */\n  levels: EscalationLevel[]\n  /** Manual escalate callback */\n  onManualEscalate?: (levelNumber: number) => Promise<void>\n  /** Resolve callback */\n  onResolve?: () => Promise<void>\n  /** Contact callback */\n  onContactPerson?: (contact: EscalationContact, method: \"email\" | \"phone\") => void\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction formatTimeRemaining(activatedAt: string | Date, slaHours: number): string {\n  const activated = typeof activatedAt === \"string\" ? new Date(activatedAt) : activatedAt\n  const deadline = new Date(activated.getTime() + slaHours * 60 * 60 * 1000)\n  const now = new Date()\n  const diffMs = deadline.getTime() - now.getTime()\n\n  if (diffMs < 0) {\n    const overdueMins = Math.abs(Math.floor(diffMs / (1000 * 60)))\n    if (overdueMins > 60) {\n      return `${Math.floor(overdueMins / 60)}h overdue`\n    }\n    return `${overdueMins}m overdue`\n  }\n\n  const hours = Math.floor(diffMs / (1000 * 60 * 60))\n  const mins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60))\n\n  if (hours > 0) {\n    return `${hours}h ${mins}m remaining`\n  }\n  return `${mins}m remaining`\n}\n\nfunction isOverdue(activatedAt: string | Date, slaHours: number): boolean {\n  const activated = typeof activatedAt === \"string\" ? new Date(activatedAt) : activatedAt\n  const deadline = new Date(activated.getTime() + slaHours * 60 * 60 * 1000)\n  return new Date() > deadline\n}\n\n// ============================================================================\n// Contact Card\n// ============================================================================\n\nfunction ContactCard({\n  contact,\n  onContact,\n}: {\n  contact: EscalationContact\n  onContact?: (method: \"email\" | \"phone\") => void\n}) {\n  return (\n    <div className=\"flex items-center gap-3\">\n      <Avatar className=\"h-10 w-10\">\n        {contact.avatarUrl ? (\n          <img src={contact.avatarUrl} alt={contact.name} />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center bg-muted text-sm font-medium\">\n            {contact.name.charAt(0).toUpperCase()}\n          </div>\n        )}\n      </Avatar>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"font-medium\">{contact.name}</p>\n        <p className=\"text-xs text-muted-foreground\">{contact.role}</p>\n      </div>\n      <div className=\"flex items-center gap-1\">\n        {contact.email && onContact && (\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 p-0\"\n                  onClick={() => onContact(\"email\")}\n                >\n                  <Mail className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>Email {contact.name}</TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        )}\n        {contact.phone && onContact && (\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 p-0\"\n                  onClick={() => onContact(\"phone\")}\n                >\n                  <Phone className=\"h-4 w-4\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>Call {contact.name}</TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        )}\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Level Card\n// ============================================================================\n\nfunction LevelCard({\n  level,\n  isCurrentLevel,\n  isFutureLevel,\n  onManualEscalate,\n  onContactPerson,\n  isEscalating,\n}: {\n  level: EscalationLevel\n  isCurrentLevel: boolean\n  isFutureLevel: boolean\n  onManualEscalate?: () => Promise<void>\n  onContactPerson?: (contact: EscalationContact, method: \"email\" | \"phone\") => void\n  isEscalating: boolean\n}) {\n  const overdue = level.activatedAt ? isOverdue(level.activatedAt, level.slaHours) : false\n\n  const getStatusConfig = () => {\n    switch (level.status) {\n      case \"completed\":\n        return {\n          icon: CheckCircle,\n          color: \"text-green-600\",\n          bg: \"bg-green-100 dark:bg-green-900\",\n          border: \"border-green-300\",\n          label: \"Completed\",\n        }\n      case \"active\":\n        return overdue\n          ? {\n              icon: AlertTriangle,\n              color: \"text-red-600\",\n              bg: \"bg-red-100 dark:bg-red-900\",\n              border: \"border-red-300\",\n              label: \"Overdue\",\n            }\n          : {\n              icon: Clock,\n              color: \"text-amber-600\",\n              bg: \"bg-amber-100 dark:bg-amber-900\",\n              border: \"border-amber-300\",\n              label: \"Active\",\n            }\n      case \"skipped\":\n        return {\n          icon: ChevronUp,\n          color: \"text-gray-600\",\n          bg: \"bg-gray-100 dark:bg-gray-800\",\n          border: \"border-gray-300\",\n          label: \"Skipped\",\n        }\n      default:\n        return {\n          icon: Clock,\n          color: \"text-gray-400\",\n          bg: \"bg-gray-50 dark:bg-gray-900\",\n          border: \"border-gray-200\",\n          label: \"Pending\",\n        }\n    }\n  }\n\n  const config = getStatusConfig()\n  const StatusIcon = config.icon\n\n  return (\n    <div\n      className={cn(\n        \"relative rounded-lg border p-4\",\n        config.border,\n        isCurrentLevel && \"ring-2 ring-primary\",\n        isFutureLevel && \"opacity-50\"\n      )}\n    >\n      {/* Level indicator */}\n      <div className=\"absolute -left-3 top-4 flex h-6 w-6 items-center justify-center rounded-full bg-background border-2 border-muted font-bold text-sm\">\n        {level.level}\n      </div>\n\n      <div className=\"ml-4 space-y-3\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h4 className=\"font-medium\">{level.name}</h4>\n            {level.description && (\n              <p className=\"text-xs text-muted-foreground\">{level.description}</p>\n            )}\n          </div>\n          <Badge className={cn(\"gap-1\", config.bg, config.color, \"border-0\")}>\n            <StatusIcon className=\"h-3 w-3\" />\n            {config.label}\n          </Badge>\n        </div>\n\n        {/* Contact */}\n        <ContactCard\n          contact={level.contact}\n          onContact={\n            onContactPerson\n              ? (method) => onContactPerson(level.contact, method)\n              : undefined\n          }\n        />\n\n        {/* SLA Timer */}\n        {level.status === \"active\" && level.activatedAt && (\n          <div\n            className={cn(\n              \"flex items-center gap-2 rounded px-2 py-1 text-sm\",\n              overdue ? \"bg-red-100 text-red-700\" : \"bg-amber-100 text-amber-700\"\n            )}\n          >\n            <Clock className=\"h-4 w-4\" />\n            <span>{formatTimeRemaining(level.activatedAt, level.slaHours)}</span>\n            <span className=\"text-xs opacity-75\">({level.slaHours}h SLA)</span>\n          </div>\n        )}\n\n        {/* Notified badge */}\n        {level.notifiedAt && (\n          <div className=\"text-xs text-muted-foreground\">\n            Notified: {new Date(level.notifiedAt).toLocaleString()}\n          </div>\n        )}\n\n        {/* Escalate button for future levels */}\n        {isFutureLevel && onManualEscalate && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={onManualEscalate}\n            disabled={isEscalating}\n            className=\"w-full\"\n          >\n            {isEscalating ? (\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            ) : (\n              <ArrowUp className=\"mr-2 h-4 w-4\" />\n            )}\n            Escalate Now\n          </Button>\n        )}\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function EscalationLadder({\n  item,\n  levels,\n  onManualEscalate,\n  onResolve,\n  onContactPerson,\n  className,\n}: EscalationLadderProps) {\n  const [escalatingTo, setEscalatingTo] = React.useState<number | null>(null)\n  const [isResolving, setIsResolving] = React.useState(false)\n\n  const sortedLevels = [...levels].sort((a, b) => a.level - b.level)\n\n  const handleEscalate = async (levelNumber: number) => {\n    if (!onManualEscalate) return\n    setEscalatingTo(levelNumber)\n    try {\n      await onManualEscalate(levelNumber)\n    } finally {\n      setEscalatingTo(null)\n    }\n  }\n\n  const handleResolve = async () => {\n    if (!onResolve) return\n    setIsResolving(true)\n    try {\n      await onResolve()\n    } finally {\n      setIsResolving(false)\n    }\n  }\n\n  const priorityConfig = {\n    low: { color: \"bg-gray-100 text-gray-700\", label: \"Low\" },\n    normal: { color: \"bg-blue-100 text-blue-700\", label: \"Normal\" },\n    high: { color: \"bg-amber-100 text-amber-700\", label: \"High\" },\n    urgent: { color: \"bg-red-100 text-red-700\", label: \"Urgent\" },\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <ArrowUp className=\"h-5 w-5\" />\n              Escalation Path\n            </CardTitle>\n            <CardDescription>{item.title}</CardDescription>\n          </div>\n          <Badge className={cn(priorityConfig[item.priority].color)}>\n            {priorityConfig[item.priority].label} Priority\n          </Badge>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* Escalation Levels */}\n        <div className=\"relative ml-3 space-y-4\">\n          {/* Connecting line */}\n          <div className=\"absolute left-0 top-0 bottom-0 w-0.5 bg-muted\" />\n\n          {sortedLevels.map((level) => (\n            <LevelCard\n              key={level.level}\n              level={level}\n              isCurrentLevel={level.level === item.currentLevel}\n              isFutureLevel={level.level > item.currentLevel}\n              onManualEscalate={\n                onManualEscalate && level.level > item.currentLevel\n                  ? () => handleEscalate(level.level)\n                  : undefined\n              }\n              onContactPerson={onContactPerson}\n              isEscalating={escalatingTo === level.level}\n            />\n          ))}\n        </div>\n\n        {/* Resolve Button */}\n        {onResolve && (\n          <div className=\"pt-4 border-t\">\n            <Button\n              onClick={handleResolve}\n              disabled={isResolving}\n              className=\"w-full\"\n            >\n              {isResolving ? (\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              ) : (\n                <CheckCircle className=\"mr-2 h-4 w-4\" />\n              )}\n              Mark as Resolved\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { EscalationStatus, EscalationContact, EscalationLevel, EscalationItem }\n"
    }
  ]
}