{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "risk-score-display",
  "type": "registry:block",
  "title": "Risk Score Display (Audit)",
  "description": "Real-time risk assessment with gauge visualization, contributing factors breakdown, and recommendations",
  "categories": [
    "audit",
    "compliance",
    "risk"
  ],
  "registryDependencies": [
    "card",
    "progress",
    "tooltip"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/audit/risk-score-display.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Risk Score Display - Audit Component\n *\n * Real-time risk assessment visualization.\n * Implements A01-CANONICAL.md §5 — Nexus Doctrine (Risk Awareness)\n *\n * Features:\n * - Risk gauge visualization\n * - Contributing factors breakdown\n * - Historical trend\n * - Action recommendations\n * - Threshold alerts\n *\n * @example\n * ```tsx\n * import { RiskScoreDisplay } from \"@workspace/design-system\"\n *\n * <RiskScoreDisplay\n *   score={75}\n *   factors={riskFactors}\n *   trend={historicalScores}\n *   onViewDetails={() => openRiskDetails()}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Progress } from \"@/components/progress\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  AlertTriangle,\n  CheckCircle,\n  TrendingUp,\n  TrendingDown,\n  ArrowRight,\n  Shield,\n  AlertCircle,\n  Info,\n  Zap,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type RiskLevel = \"low\" | \"medium\" | \"high\" | \"critical\"\n\nexport interface RiskFactor {\n  id: string\n  name: string\n  description?: string\n  impact: number // 0-100 contribution to total score\n  category: string\n  trend?: \"improving\" | \"worsening\" | \"stable\"\n}\n\nexport interface RiskTrendPoint {\n  date: string | Date\n  score: number\n}\n\nexport interface RiskAction {\n  id: string\n  label: string\n  description?: string\n  priority: \"high\" | \"medium\" | \"low\"\n  action?: () => void\n}\n\nexport interface RiskScoreDisplayProps {\n  /** Risk score (0-100) */\n  score: number\n  /** Previous score for comparison */\n  previousScore?: number\n  /** Contributing factors */\n  factors?: RiskFactor[]\n  /** Historical trend */\n  trend?: RiskTrendPoint[]\n  /** Recommended actions */\n  actions?: RiskAction[]\n  /** View details callback */\n  onViewDetails?: () => void\n  /** Threshold configuration */\n  thresholds?: {\n    low: number\n    medium: number\n    high: number\n  }\n  /** Title */\n  title?: string\n  /** Compact mode */\n  compact?: boolean\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst DEFAULT_THRESHOLDS = {\n  low: 30,\n  medium: 60,\n  high: 80,\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction getRiskLevel(score: number, thresholds = DEFAULT_THRESHOLDS): RiskLevel {\n  if (score < thresholds.low) return \"low\"\n  if (score < thresholds.medium) return \"medium\"\n  if (score < thresholds.high) return \"high\"\n  return \"critical\"\n}\n\nfunction getRiskConfig(level: RiskLevel) {\n  return {\n    low: {\n      label: \"Low Risk\",\n      color: \"text-green-600\",\n      bgColor: \"bg-green-100 dark:bg-green-900\",\n      borderColor: \"border-green-300\",\n      gaugeColor: \"#22c55e\",\n    },\n    medium: {\n      label: \"Medium Risk\",\n      color: \"text-amber-600\",\n      bgColor: \"bg-amber-100 dark:bg-amber-900\",\n      borderColor: \"border-amber-300\",\n      gaugeColor: \"#f59e0b\",\n    },\n    high: {\n      label: \"High Risk\",\n      color: \"text-orange-600\",\n      bgColor: \"bg-orange-100 dark:bg-orange-900\",\n      borderColor: \"border-orange-300\",\n      gaugeColor: \"#f97316\",\n    },\n    critical: {\n      label: \"Critical Risk\",\n      color: \"text-red-600\",\n      bgColor: \"bg-red-100 dark:bg-red-900\",\n      borderColor: \"border-red-300\",\n      gaugeColor: \"#ef4444\",\n    },\n  }[level]\n}\n\n// ============================================================================\n// Risk Gauge\n// ============================================================================\n\nfunction RiskGauge({\n  score,\n  previousScore,\n  thresholds = DEFAULT_THRESHOLDS,\n  size = 160,\n}: {\n  score: number\n  previousScore?: number\n  thresholds?: typeof DEFAULT_THRESHOLDS\n  size?: number\n}) {\n  const level = getRiskLevel(score, thresholds)\n  const config = getRiskConfig(level)\n\n  // SVG calculations\n  const strokeWidth = 12\n  const radius = (size - strokeWidth) / 2\n  const circumference = radius * Math.PI // Semi-circle\n  const offset = circumference - (score / 100) * circumference\n\n  const change = previousScore !== undefined ? score - previousScore : null\n\n  return (\n    <div className=\"flex flex-col items-center\">\n      <div className=\"relative\" style={{ width: size, height: size / 2 + 20 }}>\n        <svg\n          width={size}\n          height={size / 2 + strokeWidth}\n          viewBox={`0 0 ${size} ${size / 2 + strokeWidth}`}\n        >\n          {/* Background arc */}\n          <path\n            d={`M ${strokeWidth / 2} ${size / 2} A ${radius} ${radius} 0 0 1 ${size - strokeWidth / 2} ${size / 2}`}\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth={strokeWidth}\n            className=\"text-muted\"\n          />\n\n          {/* Threshold markers */}\n          {Object.entries(thresholds).map(([key, value]) => {\n            const angle = (value / 100) * 180\n            const x = size / 2 + radius * Math.cos((180 - angle) * (Math.PI / 180))\n            const y = size / 2 - radius * Math.sin((180 - angle) * (Math.PI / 180))\n            return (\n              <circle\n                key={key}\n                cx={x}\n                cy={y}\n                r={3}\n                fill=\"currentColor\"\n                className=\"text-muted-foreground\"\n              />\n            )\n          })}\n\n          {/* Score arc */}\n          <path\n            d={`M ${strokeWidth / 2} ${size / 2} A ${radius} ${radius} 0 0 1 ${size - strokeWidth / 2} ${size / 2}`}\n            fill=\"none\"\n            stroke={config.gaugeColor}\n            strokeWidth={strokeWidth}\n            strokeDasharray={circumference}\n            strokeDashoffset={offset}\n            strokeLinecap=\"round\"\n            className=\"transition-all duration-500\"\n          />\n        </svg>\n\n        {/* Center content */}\n        <div className=\"absolute inset-0 flex flex-col items-center justify-end pb-0\">\n          <span className={cn(\"text-4xl font-bold\", config.color)}>{score}</span>\n          <Badge className={cn(\"mt-1\", config.bgColor, config.color, \"border-0\")}>\n            {config.label}\n          </Badge>\n        </div>\n      </div>\n\n      {/* Change indicator */}\n      {change !== null && (\n        <div\n          className={cn(\n            \"mt-2 flex items-center gap-1 text-sm\",\n            change > 0 ? \"text-red-600\" : change < 0 ? \"text-green-600\" : \"text-muted-foreground\"\n          )}\n        >\n          {change > 0 ? (\n            <TrendingUp className=\"h-4 w-4\" />\n          ) : change < 0 ? (\n            <TrendingDown className=\"h-4 w-4\" />\n          ) : null}\n          <span>\n            {change > 0 ? \"+\" : \"\"}\n            {change} from previous\n          </span>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// Mini Sparkline\n// ============================================================================\n\nfunction TrendSparkline({ data }: { data: RiskTrendPoint[] }) {\n  if (!data || data.length < 2) return null\n\n  const scores = data.map((d) => d.score)\n  const max = Math.max(...scores)\n  const min = Math.min(...scores)\n  const range = max - min || 1\n\n  const width = 120\n  const height = 32\n\n  const points = scores\n    .map((score, index) => {\n      const x = (index / (scores.length - 1)) * width\n      const y = height - ((score - min) / range) * height\n      return `${x},${y}`\n    })\n    .join(\" \")\n\n  const isImproving = scores[scores.length - 1] < scores[0]\n\n  return (\n    <div className=\"space-y-1\">\n      <p className=\"text-xs text-muted-foreground\">30-Day Trend</p>\n      <svg width={width} height={height} className=\"overflow-visible\">\n        <polyline\n          points={points}\n          fill=\"none\"\n          stroke={isImproving ? \"#22c55e\" : \"#ef4444\"}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n        />\n      </svg>\n    </div>\n  )\n}\n\n// ============================================================================\n// Factor List\n// ============================================================================\n\nfunction FactorList({ factors }: { factors: RiskFactor[] }) {\n  const sortedFactors = [...factors].sort((a, b) => b.impact - a.impact)\n\n  return (\n    <div className=\"space-y-3\">\n      <h4 className=\"text-sm font-medium\">Contributing Factors</h4>\n      <div className=\"space-y-2\">\n        {sortedFactors.slice(0, 5).map((factor) => (\n          <div key={factor.id} className=\"space-y-1\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <div className=\"flex items-center gap-2\">\n                <span>{factor.name}</span>\n                {factor.trend && (\n                  <span\n                    className={cn(\n                      \"text-xs\",\n                      factor.trend === \"improving\"\n                        ? \"text-green-600\"\n                        : factor.trend === \"worsening\"\n                        ? \"text-red-600\"\n                        : \"text-muted-foreground\"\n                    )}\n                  >\n                    {factor.trend === \"improving\" ? \"↓\" : factor.trend === \"worsening\" ? \"↑\" : \"→\"}\n                  </span>\n                )}\n              </div>\n              <span className=\"font-medium\">{factor.impact}%</span>\n            </div>\n            <Progress value={factor.impact} className=\"h-1.5\" />\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Action List\n// ============================================================================\n\nfunction ActionList({ actions }: { actions: RiskAction[] }) {\n  const sortedActions = [...actions].sort((a, b) => {\n    const priority = { high: 0, medium: 1, low: 2 }\n    return priority[a.priority] - priority[b.priority]\n  })\n\n  return (\n    <div className=\"space-y-3\">\n      <h4 className=\"text-sm font-medium flex items-center gap-2\">\n        <Zap className=\"h-4 w-4 text-primary\" />\n        Recommended Actions\n      </h4>\n      <div className=\"space-y-2\">\n        {sortedActions.slice(0, 3).map((action) => (\n          <div\n            key={action.id}\n            className={cn(\n              \"flex items-start gap-3 rounded-lg border p-3\",\n              action.priority === \"high\" && \"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950\",\n              action.priority === \"medium\" && \"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950\"\n            )}\n          >\n            <div className=\"flex-1\">\n              <p className=\"font-medium text-sm\">{action.label}</p>\n              {action.description && (\n                <p className=\"text-xs text-muted-foreground mt-0.5\">{action.description}</p>\n              )}\n            </div>\n            {action.action && (\n              <Button variant=\"ghost\" size=\"sm\" onClick={action.action}>\n                <ArrowRight className=\"h-4 w-4\" />\n              </Button>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function RiskScoreDisplay({\n  score,\n  previousScore,\n  factors = [],\n  trend = [],\n  actions = [],\n  onViewDetails,\n  thresholds = DEFAULT_THRESHOLDS,\n  title = \"Risk Score\",\n  compact = false,\n  className,\n}: RiskScoreDisplayProps) {\n  const level = getRiskLevel(score, thresholds)\n  const config = getRiskConfig(level)\n\n  if (compact) {\n    return (\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger>\n            <div\n              className={cn(\n                \"inline-flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer\",\n                config.bgColor,\n                className\n              )}\n              onClick={onViewDetails}\n            >\n              <Shield className={cn(\"h-4 w-4\", config.color)} />\n              <span className={cn(\"font-bold\", config.color)}>{score}</span>\n              <Badge className={cn(\"text-xs\", config.bgColor, config.color, \"border-0\")}>\n                {config.label}\n              </Badge>\n            </div>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>Risk Score: {score}/100</p>\n            <p className=\"text-xs text-muted-foreground\">Click to view details</p>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    )\n  }\n\n  return (\n    <Card className={cn(level === \"critical\" && \"border-red-300\", className)}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Shield className=\"h-5 w-5\" />\n              {title}\n            </CardTitle>\n            <CardDescription>Real-time risk assessment</CardDescription>\n          </div>\n          {onViewDetails && (\n            <Button variant=\"outline\" size=\"sm\" onClick={onViewDetails}>\n              View Details\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-6\">\n        {/* Risk Gauge */}\n        <div className=\"flex justify-center\">\n          <RiskGauge score={score} previousScore={previousScore} thresholds={thresholds} />\n        </div>\n\n        {/* Trend Sparkline */}\n        {trend.length > 1 && (\n          <div className=\"flex justify-center\">\n            <TrendSparkline data={trend} />\n          </div>\n        )}\n\n        {/* Factors */}\n        {factors.length > 0 && <FactorList factors={factors} />}\n\n        {/* Actions */}\n        {actions.length > 0 && <ActionList actions={actions} />}\n\n        {/* Alert for critical */}\n        {level === \"critical\" && (\n          <div className=\"flex items-start gap-3 rounded-lg border border-red-300 bg-red-50 p-4 dark:border-red-800 dark:bg-red-950\">\n            <AlertTriangle className=\"h-5 w-5 text-red-600 shrink-0\" />\n            <div>\n              <p className=\"font-medium text-red-700 dark:text-red-300\">Critical Risk Level</p>\n              <p className=\"text-sm text-red-600 dark:text-red-400\">\n                Immediate action is required. Review contributing factors and recommended actions.\n              </p>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { RiskLevel, RiskFactor, RiskTrendPoint, RiskAction }\n"
    }
  ]
}