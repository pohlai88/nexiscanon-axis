{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "command-k",
  "type": "registry:block",
  "title": "Command K (Quorum)",
  "description": "Global command palette with fuzzy search, keyboard navigation, and AI-powered suggestions for Quorum kernel operations",
  "categories": [
    "quorum",
    "analysis",
    "navigation"
  ],
  "registryDependencies": [
    "command",
    "dialog",
    "input"
  ],
  "dependencies": [
    "motion"
  ],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/quorum/command-k.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * CommandK (⌘K) - Quorum Kernel Command Palette\n *\n * A comprehensive command palette for white-collar users (CFO, Controller, Auditor, etc.)\n * Implements A01-CANONICAL.md §4 — \"Surface the truth before they ask\"\n *\n * Features:\n * - Global fuzzy search across all entities\n * - Recent actions history\n * - Suggested next actions based on context\n * - Keyboard shortcuts for power users\n * - Quick navigation to any module\n *\n * @example\n * ```tsx\n * import { CommandK, useCommandK } from \"@workspace/design-system\"\n *\n * function App() {\n *   const { open, setOpen } = useCommandK()\n *\n *   return (\n *     <CommandK\n *       open={open}\n *       onOpenChange={setOpen}\n *       recentItems={recentItems}\n *       suggestions={suggestions}\n *       onSearch={handleSearch}\n *       onNavigate={handleNavigate}\n *     />\n *   )\n * }\n * ```\n */\n\nimport * as React from \"react\"\nimport {\n  Command,\n  CommandDialog,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n  CommandShortcut,\n} from \"@/components/command\"\nimport { Badge } from \"@/components/badge\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  Search,\n  Clock,\n  Lightbulb,\n  FileText,\n  Users,\n  Package,\n  DollarSign,\n  ArrowRight,\n  Calculator,\n  AlertTriangle,\n  TrendingUp,\n  CheckCircle,\n  XCircle,\n  Loader2,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type CommandKItemType =\n  | \"navigation\"\n  | \"action\"\n  | \"entity\"\n  | \"search\"\n  | \"document\"\n  | \"customer\"\n  | \"supplier\"\n  | \"item\"\n  | \"invoice\"\n  | \"order\"\n\nexport interface CommandKItem {\n  id: string\n  type: CommandKItemType\n  label: string\n  description?: string\n  icon?: React.ComponentType<{ className?: string }>\n  shortcut?: string\n  badge?: string\n  badgeVariant?: \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n  metadata?: Record<string, unknown>\n  onSelect?: () => void\n}\n\nexport interface CommandKGroup {\n  id: string\n  heading: string\n  items: CommandKItem[]\n  priority?: number\n}\n\nexport interface CommandKProps {\n  /** Controlled open state */\n  open: boolean\n  /** Callback when open state changes */\n  onOpenChange: (open: boolean) => void\n  /** Recently accessed items */\n  recentItems?: CommandKItem[]\n  /** Suggested actions based on context */\n  suggestions?: CommandKItem[]\n  /** Navigation links */\n  navigation?: CommandKItem[]\n  /** Quick actions */\n  quickActions?: CommandKItem[]\n  /** Custom groups */\n  groups?: CommandKGroup[]\n  /** Search callback - return search results */\n  onSearch?: (query: string) => Promise<CommandKItem[]> | CommandKItem[]\n  /** Navigation callback */\n  onNavigate?: (item: CommandKItem) => void\n  /** Loading state during search */\n  isSearching?: boolean\n  /** Placeholder text */\n  placeholder?: string\n  /** Empty state message */\n  emptyMessage?: string\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Icon Mapping\n// ============================================================================\n\nconst TYPE_ICONS: Record<CommandKItemType, React.ComponentType<{ className?: string }>> = {\n  navigation: ArrowRight,\n  action: Lightbulb,\n  entity: Package,\n  search: Search,\n  document: FileText,\n  customer: Users,\n  supplier: Users,\n  item: Package,\n  invoice: DollarSign,\n  order: FileText,\n}\n\n// ============================================================================\n// CommandK Component\n// ============================================================================\n\nexport function CommandK({\n  open,\n  onOpenChange,\n  recentItems = [],\n  suggestions = [],\n  navigation = [],\n  quickActions = [],\n  groups = [],\n  onSearch,\n  onNavigate,\n  isSearching = false,\n  placeholder = \"Search anything... ⌘K\",\n  emptyMessage = \"No results found. Try a different search term.\",\n  className,\n}: CommandKProps) {\n  const [query, setQuery] = React.useState(\"\")\n  const [searchResults, setSearchResults] = React.useState<CommandKItem[]>([])\n  const [localSearching, setLocalSearching] = React.useState(false)\n\n  // Debounced search\n  React.useEffect(() => {\n    if (!query || !onSearch) {\n      setSearchResults([])\n      return\n    }\n\n    const timeoutId = setTimeout(async () => {\n      setLocalSearching(true)\n      try {\n        const results = await onSearch(query)\n        setSearchResults(results)\n      } catch (error) {\n        console.error(\"CommandK search error:\", error)\n        setSearchResults([])\n      } finally {\n        setLocalSearching(false)\n      }\n    }, 200)\n\n    return () => clearTimeout(timeoutId)\n  }, [query, onSearch])\n\n  // Reset query when dialog closes\n  React.useEffect(() => {\n    if (!open) {\n      setQuery(\"\")\n      setSearchResults([])\n    }\n  }, [open])\n\n  const handleSelect = React.useCallback(\n    (item: CommandKItem) => {\n      if (item.onSelect) {\n        item.onSelect()\n      }\n      if (onNavigate) {\n        onNavigate(item)\n      }\n      onOpenChange(false)\n    },\n    [onNavigate, onOpenChange]\n  )\n\n  const renderItem = React.useCallback(\n    (item: CommandKItem) => {\n      const Icon = item.icon || TYPE_ICONS[item.type] || Search\n      return (\n        <CommandItem\n          key={item.id}\n          value={`${item.label} ${item.description || \"\"}`}\n          onSelect={() => handleSelect(item)}\n          className=\"flex items-center gap-3 px-3 py-2\"\n        >\n          <Icon className=\"h-4 w-4 shrink-0 text-muted-foreground\" />\n          <div className=\"flex flex-1 flex-col\">\n            <span className=\"font-medium\">{item.label}</span>\n            {item.description && (\n              <span className=\"text-xs text-muted-foreground\">\n                {item.description}\n              </span>\n            )}\n          </div>\n          {item.badge && (\n            <Badge variant={item.badgeVariant || \"secondary\"} className=\"ml-2\">\n              {item.badge}\n            </Badge>\n          )}\n          {item.shortcut && (\n            <CommandShortcut>{item.shortcut}</CommandShortcut>\n          )}\n        </CommandItem>\n      )\n    },\n    [handleSelect]\n  )\n\n  const showLoading = isSearching || localSearching\n  const showRecent = !query && recentItems.length > 0\n  const showSuggestions = !query && suggestions.length > 0\n  const showNavigation = !query && navigation.length > 0\n  const showQuickActions = !query && quickActions.length > 0\n  const showSearchResults = query && searchResults.length > 0\n  const showCustomGroups = !query && groups.length > 0\n\n  return (\n    <CommandDialog\n      open={open}\n      onOpenChange={onOpenChange}\n      title=\"Command Palette\"\n      description=\"Search, navigate, or run commands\"\n    >\n      <Command\n        className={cn(\n          \"rounded-lg border-0 shadow-2xl\",\n          \"[&_[data-slot=command-input-wrapper]]:border-b\",\n          className\n        )}\n        shouldFilter={!onSearch}\n      >\n        <CommandInput\n          placeholder={placeholder}\n          value={query}\n          onValueChange={setQuery}\n        />\n        <CommandList className=\"max-h-[400px]\">\n          {/* Loading State */}\n          {showLoading && (\n            <div className=\"flex items-center justify-center py-6\">\n              <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n              <span className=\"ml-2 text-sm text-muted-foreground\">\n                Searching...\n              </span>\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!showLoading && query && searchResults.length === 0 && (\n            <CommandEmpty className=\"py-6 text-center\">\n              <Search className=\"mx-auto mb-2 h-8 w-8 text-muted-foreground/50\" />\n              <p className=\"text-sm text-muted-foreground\">{emptyMessage}</p>\n            </CommandEmpty>\n          )}\n\n          {/* Search Results */}\n          {!showLoading && showSearchResults && (\n            <CommandGroup heading=\"Search Results\">\n              {searchResults.map(renderItem)}\n            </CommandGroup>\n          )}\n\n          {/* Recent Items */}\n          {!showLoading && showRecent && (\n            <>\n              <CommandGroup heading=\"Recent\">\n                {recentItems.slice(0, 5).map((item) => ({\n                  ...item,\n                  icon: item.icon || Clock,\n                })).map(renderItem)}\n              </CommandGroup>\n              <CommandSeparator />\n            </>\n          )}\n\n          {/* Suggestions */}\n          {!showLoading && showSuggestions && (\n            <>\n              <CommandGroup heading=\"Suggestions\">\n                {suggestions.slice(0, 5).map((item) => ({\n                  ...item,\n                  icon: item.icon || Lightbulb,\n                })).map(renderItem)}\n              </CommandGroup>\n              <CommandSeparator />\n            </>\n          )}\n\n          {/* Quick Actions */}\n          {!showLoading && showQuickActions && (\n            <>\n              <CommandGroup heading=\"Quick Actions\">\n                {quickActions.map(renderItem)}\n              </CommandGroup>\n              <CommandSeparator />\n            </>\n          )}\n\n          {/* Navigation */}\n          {!showLoading && showNavigation && (\n            <>\n              <CommandGroup heading=\"Navigation\">\n                {navigation.map(renderItem)}\n              </CommandGroup>\n            </>\n          )}\n\n          {/* Custom Groups */}\n          {!showLoading &&\n            showCustomGroups &&\n            groups\n              .sort((a, b) => (a.priority || 0) - (b.priority || 0))\n              .map((group, index) => (\n                <React.Fragment key={group.id}>\n                  {index > 0 && <CommandSeparator />}\n                  <CommandGroup heading={group.heading}>\n                    {group.items.map(renderItem)}\n                  </CommandGroup>\n                </React.Fragment>\n              ))}\n        </CommandList>\n\n        {/* Footer with keyboard hints */}\n        <div className=\"flex items-center justify-between border-t px-3 py-2 text-xs text-muted-foreground\">\n          <div className=\"flex items-center gap-2\">\n            <kbd className=\"rounded bg-muted px-1.5 py-0.5 font-mono\">↑↓</kbd>\n            <span>Navigate</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <kbd className=\"rounded bg-muted px-1.5 py-0.5 font-mono\">↵</kbd>\n            <span>Select</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <kbd className=\"rounded bg-muted px-1.5 py-0.5 font-mono\">esc</kbd>\n            <span>Close</span>\n          </div>\n        </div>\n      </Command>\n    </CommandDialog>\n  )\n}\n\n// ============================================================================\n// useCommandK Hook\n// ============================================================================\n\nexport interface UseCommandKOptions {\n  /** Keyboard shortcut key (default: \"k\") */\n  shortcutKey?: string\n  /** Require meta key (default: true) */\n  requireMeta?: boolean\n}\n\nexport function useCommandK(options: UseCommandKOptions = {}) {\n  const { shortcutKey = \"k\", requireMeta = true } = options\n  const [open, setOpen] = React.useState(false)\n\n  React.useEffect(() => {\n    const down = (e: KeyboardEvent) => {\n      const metaPressed = e.metaKey || e.ctrlKey\n      const keyMatch = e.key.toLowerCase() === shortcutKey.toLowerCase()\n\n      if (keyMatch && (requireMeta ? metaPressed : true)) {\n        e.preventDefault()\n        setOpen((prev) => !prev)\n      }\n    }\n\n    document.addEventListener(\"keydown\", down)\n    return () => document.removeEventListener(\"keydown\", down)\n  }, [shortcutKey, requireMeta])\n\n  return { open, setOpen, toggle: () => setOpen((prev) => !prev) }\n}\n\n// ============================================================================\n// Preset Action Builders (A01-CANONICAL.md aligned)\n// ============================================================================\n\nexport const CommandKActions = {\n  /** Create navigation item */\n  navigation: (\n    id: string,\n    label: string,\n    path: string,\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"navigation\",\n    label,\n    description: path,\n    onSelect: () => {\n      if (typeof window !== \"undefined\") {\n        window.location.href = path\n      }\n    },\n    ...options,\n  }),\n\n  /** Create document action */\n  document: (\n    id: string,\n    label: string,\n    docType: string,\n    docId: string,\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"document\",\n    label,\n    description: `${docType} #${docId}`,\n    icon: FileText,\n    ...options,\n  }),\n\n  /** Create quick action */\n  action: (\n    id: string,\n    label: string,\n    onSelect: () => void,\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"action\",\n    label,\n    onSelect,\n    ...options,\n  }),\n\n  /** Create exception/alert item (Quorum: Exception Hunting) */\n  exception: (\n    id: string,\n    label: string,\n    severity: \"high\" | \"medium\" | \"low\",\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"action\",\n    label,\n    icon: AlertTriangle,\n    badge: severity.toUpperCase(),\n    badgeVariant: severity === \"high\" ? \"destructive\" : \"secondary\",\n    ...options,\n  }),\n\n  /** Create trend item (Quorum: Trend Analysis) */\n  trend: (\n    id: string,\n    label: string,\n    change: string,\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"action\",\n    label,\n    icon: TrendingUp,\n    badge: change,\n    badgeVariant: change.startsWith(\"+\") ? \"default\" : \"destructive\",\n    ...options,\n  }),\n\n  /** Create approval item (A01 §8 AFANDA: Approval Queue) */\n  approval: (\n    id: string,\n    label: string,\n    status: \"pending\" | \"approved\" | \"rejected\",\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"action\",\n    label,\n    icon: status === \"approved\" ? CheckCircle : status === \"rejected\" ? XCircle : Clock,\n    badge: status.toUpperCase(),\n    badgeVariant: status === \"approved\" ? \"default\" : status === \"rejected\" ? \"destructive\" : \"secondary\",\n    ...options,\n  }),\n\n  /** Create calculation/report item */\n  calculation: (\n    id: string,\n    label: string,\n    value: string,\n    options?: Partial<CommandKItem>\n  ): CommandKItem => ({\n    id,\n    type: \"action\",\n    label,\n    icon: Calculator,\n    badge: value,\n    ...options,\n  }),\n}\n\n// ============================================================================\n// Default Navigation Items (ERP-focused)\n// ============================================================================\n\nexport const DEFAULT_ERP_NAVIGATION: CommandKItem[] = [\n  CommandKActions.navigation(\"nav-dashboard\", \"Dashboard\", \"/dashboard\", { shortcut: \"⌘D\" }),\n  CommandKActions.navigation(\"nav-invoices\", \"Invoices\", \"/invoices\", { shortcut: \"⌘I\" }),\n  CommandKActions.navigation(\"nav-orders\", \"Sales Orders\", \"/orders\"),\n  CommandKActions.navigation(\"nav-purchases\", \"Purchase Orders\", \"/purchases\"),\n  CommandKActions.navigation(\"nav-inventory\", \"Inventory\", \"/inventory\"),\n  CommandKActions.navigation(\"nav-customers\", \"Customers\", \"/customers\"),\n  CommandKActions.navigation(\"nav-suppliers\", \"Suppliers\", \"/suppliers\"),\n  CommandKActions.navigation(\"nav-reports\", \"Reports\", \"/reports\"),\n  CommandKActions.navigation(\"nav-settings\", \"Settings\", \"/settings\", { shortcut: \"⌘,\" }),\n]\n\nexport const DEFAULT_QUICK_ACTIONS: CommandKItem[] = [\n  CommandKActions.action(\"action-new-invoice\", \"Create Invoice\", () => {}, {\n    shortcut: \"⌘N\",\n    description: \"Create a new sales invoice\",\n    icon: FileText,\n  }),\n  CommandKActions.action(\"action-trial-balance\", \"Run Trial Balance\", () => {}, {\n    description: \"Generate trial balance report\",\n    icon: Calculator,\n  }),\n  CommandKActions.action(\"action-aging-report\", \"AR Aging Report\", () => {}, {\n    description: \"View accounts receivable aging\",\n    icon: DollarSign,\n  }),\n]\n"
    }
  ]
}