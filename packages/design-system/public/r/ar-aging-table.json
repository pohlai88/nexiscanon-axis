{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ar-aging-table",
  "type": "registry:block",
  "title": "AR Aging Table (ERP)",
  "description": "Accounts Receivable aging analysis with bucket breakdown, customer details, and collection status",
  "categories": [
    "erp",
    "accounting",
    "receivables"
  ],
  "registryDependencies": [
    "table",
    "card",
    "badge",
    "tooltip"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/erp/ar-aging-table.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * AR Aging Table - ERP Domain Component\n *\n * Accounts Receivable aging analysis.\n * Implements A01-CANONICAL.md §3 — Three Pillars (Obligations: \"Who owes whom?\")\n *\n * Features:\n * - Aging buckets (Current, 30, 60, 90, 90+)\n * - Customer drill-down\n * - Total outstanding\n * - Payment status indicators\n * - Overdue alerts\n * - Export functionality\n *\n * @example\n * ```tsx\n * import { ARAgingTable } from \"@workspace/design-system\"\n *\n * <ARAgingTable\n *   data={arAgingData}\n *   onCustomerClick={(customer) => router.push(`/customers/${customer.id}`)}\n *   onExport={(format) => exportAging(format)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/table\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Progress } from \"@/components/progress\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/dropdown-menu\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  DollarSign,\n  AlertTriangle,\n  TrendingUp,\n  TrendingDown,\n  Download,\n  ChevronDown,\n  ChevronRight,\n  ExternalLink,\n  Clock,\n  CheckCircle,\n  AlertCircle,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types (AgingBucket imported from shared types to avoid conflicts)\n// ============================================================================\n\nimport type { AgingBucket } from \"../types\"\n\nexport interface CustomerAging {\n  id: string\n  name: string\n  code?: string\n  creditLimit?: number\n  totalOutstanding: number\n  buckets: AgingBucket\n  lastPaymentDate?: string\n  lastPaymentAmount?: number\n  paymentTerms?: string\n  trend?: \"up\" | \"down\" | \"stable\"\n  riskLevel?: \"low\" | \"medium\" | \"high\"\n}\n\nexport interface ARAgingSummary {\n  totalOutstanding: number\n  totalCurrent: number\n  total30: number\n  total60: number\n  total90: number\n  total90Plus: number\n  totalOverdue: number\n  overduePercentage: number\n  customerCount: number\n  averageDSO?: number\n}\n\nexport interface ARAgingTableProps {\n  /** Customer aging data */\n  data: CustomerAging[]\n  /** Summary totals (calculated if not provided) */\n  summary?: ARAgingSummary\n  /** Callback when customer is clicked */\n  onCustomerClick?: (customer: CustomerAging) => void\n  /** Export callback */\n  onExport?: (format: \"csv\" | \"excel\" | \"pdf\") => void\n  /** Currency symbol */\n  currency?: string\n  /** Show trend indicators */\n  showTrends?: boolean\n  /** Show risk indicators */\n  showRisk?: boolean\n  /** Collapsible customer details */\n  collapsible?: boolean\n  /** Initial sort column */\n  sortBy?: keyof AgingBucket | \"name\" | \"totalOutstanding\"\n  /** Sort direction */\n  sortDirection?: \"asc\" | \"desc\"\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction formatCurrency(amount: number, currency: string = \"$\"): string {\n  return `${currency}${amount.toLocaleString(\"en-US\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })}`\n}\n\nfunction calculateSummary(data: CustomerAging[]): ARAgingSummary {\n  const totals = data.reduce(\n    (acc, customer) => ({\n      totalOutstanding: acc.totalOutstanding + customer.totalOutstanding,\n      totalCurrent: acc.totalCurrent + customer.buckets.current,\n      total30: acc.total30 + customer.buckets.days30,\n      total60: acc.total60 + customer.buckets.days60,\n      total90: acc.total90 + customer.buckets.days90,\n      total90Plus: acc.total90Plus + customer.buckets.days90Plus,\n    }),\n    {\n      totalOutstanding: 0,\n      totalCurrent: 0,\n      total30: 0,\n      total60: 0,\n      total90: 0,\n      total90Plus: 0,\n    }\n  )\n\n  const totalOverdue =\n    totals.total30 + totals.total60 + totals.total90 + totals.total90Plus\n\n  return {\n    ...totals,\n    totalOverdue,\n    overduePercentage:\n      totals.totalOutstanding > 0\n        ? (totalOverdue / totals.totalOutstanding) * 100\n        : 0,\n    customerCount: data.length,\n  }\n}\n\n// ============================================================================\n// Sub-components\n// ============================================================================\n\nfunction AgingSummaryCards({\n  summary,\n  currency,\n}: {\n  summary: ARAgingSummary\n  currency: string\n}) {\n  const cards = [\n    {\n      label: \"Total Outstanding\",\n      value: summary.totalOutstanding,\n      icon: DollarSign,\n      color: \"text-foreground\",\n    },\n    {\n      label: \"Current\",\n      value: summary.totalCurrent,\n      icon: CheckCircle,\n      color: \"text-green-600\",\n    },\n    {\n      label: \"1-30 Days\",\n      value: summary.total30,\n      icon: Clock,\n      color: \"text-amber-500\",\n    },\n    {\n      label: \"31-60 Days\",\n      value: summary.total60,\n      icon: AlertCircle,\n      color: \"text-orange-500\",\n    },\n    {\n      label: \"61-90 Days\",\n      value: summary.total90,\n      icon: AlertTriangle,\n      color: \"text-red-500\",\n    },\n    {\n      label: \"90+ Days\",\n      value: summary.total90Plus,\n      icon: AlertTriangle,\n      color: \"text-red-700\",\n    },\n  ]\n\n  return (\n    <div className=\"grid gap-4 md:grid-cols-3 lg:grid-cols-6\">\n      {cards.map((card) => (\n        <Card key={card.label} className=\"p-4\">\n          <div className=\"flex items-center gap-2\">\n            <card.icon className={cn(\"h-4 w-4\", card.color)} />\n            <span className=\"text-xs text-muted-foreground\">{card.label}</span>\n          </div>\n          <p className={cn(\"mt-2 text-xl font-bold\", card.color)}>\n            {formatCurrency(card.value, currency)}\n          </p>\n        </Card>\n      ))}\n    </div>\n  )\n}\n\nfunction TrendIndicator({ trend }: { trend?: \"up\" | \"down\" | \"stable\" }) {\n  if (!trend) return null\n\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger>\n          <span className=\"inline-flex\">\n            {trend === \"up\" && (\n              <TrendingUp className=\"h-4 w-4 text-red-500\" />\n            )}\n            {trend === \"down\" && (\n              <TrendingDown className=\"h-4 w-4 text-green-500\" />\n            )}\n            {trend === \"stable\" && (\n              <span className=\"h-4 w-4 text-muted-foreground\">—</span>\n            )}\n          </span>\n        </TooltipTrigger>\n        <TooltipContent>\n          {trend === \"up\" && \"Balance increasing\"}\n          {trend === \"down\" && \"Balance decreasing\"}\n          {trend === \"stable\" && \"Balance stable\"}\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  )\n}\n\nfunction RiskBadge({ level }: { level?: \"low\" | \"medium\" | \"high\" }) {\n  if (!level) return null\n\n  const variants: Record<typeof level, { variant: \"default\" | \"secondary\" | \"destructive\"; label: string }> = {\n    low: { variant: \"secondary\", label: \"Low Risk\" },\n    medium: { variant: \"default\", label: \"Medium Risk\" },\n    high: { variant: \"destructive\", label: \"High Risk\" },\n  }\n\n  const config = variants[level]\n\n  return (\n    <Badge variant={config.variant} className=\"text-xs\">\n      {config.label}\n    </Badge>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function ARAgingTable({\n  data,\n  summary: providedSummary,\n  onCustomerClick,\n  onExport,\n  currency = \"$\",\n  showTrends = true,\n  showRisk = true,\n  collapsible = true,\n  className,\n}: ARAgingTableProps) {\n  const [expandedRows, setExpandedRows] = React.useState<Set<string>>(new Set())\n  const [sortBy, setSortBy] = React.useState<string>(\"totalOutstanding\")\n  const [sortDirection, setSortDirection] = React.useState<\"asc\" | \"desc\">(\"desc\")\n\n  const summary = providedSummary || calculateSummary(data)\n\n  const toggleRow = (id: string) => {\n    setExpandedRows((prev) => {\n      const next = new Set(prev)\n      if (next.has(id)) {\n        next.delete(id)\n      } else {\n        next.add(id)\n      }\n      return next\n    })\n  }\n\n  const sortedData = React.useMemo(() => {\n    return [...data].sort((a, b) => {\n      let aVal: number | string\n      let bVal: number | string\n\n      if (sortBy === \"name\") {\n        aVal = a.name\n        bVal = b.name\n      } else if (sortBy === \"totalOutstanding\") {\n        aVal = a.totalOutstanding\n        bVal = b.totalOutstanding\n      } else if (sortBy in a.buckets) {\n        aVal = a.buckets[sortBy as keyof AgingBucket]\n        bVal = b.buckets[sortBy as keyof AgingBucket]\n      } else {\n        return 0\n      }\n\n      if (typeof aVal === \"string\") {\n        return sortDirection === \"asc\"\n          ? aVal.localeCompare(bVal as string)\n          : (bVal as string).localeCompare(aVal)\n      }\n\n      return sortDirection === \"asc\" ? aVal - (bVal as number) : (bVal as number) - aVal\n    })\n  }, [data, sortBy, sortDirection])\n\n  const handleSort = (column: string) => {\n    if (sortBy === column) {\n      setSortDirection((prev) => (prev === \"asc\" ? \"desc\" : \"asc\"))\n    } else {\n      setSortBy(column)\n      setSortDirection(\"desc\")\n    }\n  }\n\n  const SortableHeader = ({\n    column,\n    children,\n    className: headerClassName,\n  }: {\n    column: string\n    children: React.ReactNode\n    className?: string\n  }) => (\n    <TableHead\n      className={cn(\"cursor-pointer select-none hover:bg-muted/50\", headerClassName)}\n      onClick={() => handleSort(column)}\n    >\n      <div className=\"flex items-center gap-1\">\n        {children}\n        {sortBy === column && (\n          <span className=\"text-xs\">{sortDirection === \"asc\" ? \"↑\" : \"↓\"}</span>\n        )}\n      </div>\n    </TableHead>\n  )\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"flex-row items-center justify-between space-y-0 pb-4\">\n        <div>\n          <CardTitle className=\"flex items-center gap-2\">\n            <DollarSign className=\"h-5 w-5\" />\n            Accounts Receivable Aging\n          </CardTitle>\n          <CardDescription>\n            {summary.customerCount} customer(s) • {summary.overduePercentage.toFixed(1)}% overdue\n          </CardDescription>\n        </div>\n        {onExport && (\n          <DropdownMenu>\n            <DropdownMenuTrigger>\n              <Button variant=\"outline\" size=\"sm\">\n                <Download className=\"mr-2 h-4 w-4\" />\n                Export\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent>\n              <DropdownMenuItem onClick={() => onExport(\"csv\")}>\n                Export as CSV\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onExport(\"excel\")}>\n                Export as Excel\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onExport(\"pdf\")}>\n                Export as PDF\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        )}\n      </CardHeader>\n\n      <CardContent className=\"space-y-6\">\n        {/* Summary Cards */}\n        <AgingSummaryCards summary={summary} currency={currency} />\n\n        {/* Overdue Progress Bar */}\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-muted-foreground\">Overdue Amount</span>\n            <span className=\"font-medium\">\n              {formatCurrency(summary.totalOverdue, currency)} of{\" \"}\n              {formatCurrency(summary.totalOutstanding, currency)}\n            </span>\n          </div>\n          <Progress value={summary.overduePercentage} className=\"h-2\" />\n        </div>\n\n        {/* Data Table */}\n        <div className=\"rounded-lg border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                {collapsible && <TableHead className=\"w-8\" />}\n                <SortableHeader column=\"name\">Customer</SortableHeader>\n                <SortableHeader column=\"totalOutstanding\" className=\"text-right\">\n                  Total\n                </SortableHeader>\n                <SortableHeader column=\"current\" className=\"text-right\">\n                  Current\n                </SortableHeader>\n                <SortableHeader column=\"days30\" className=\"text-right\">\n                  1-30\n                </SortableHeader>\n                <SortableHeader column=\"days60\" className=\"text-right\">\n                  31-60\n                </SortableHeader>\n                <SortableHeader column=\"days90\" className=\"text-right\">\n                  61-90\n                </SortableHeader>\n                <SortableHeader column=\"days90Plus\" className=\"text-right\">\n                  90+\n                </SortableHeader>\n                {showTrends && <TableHead className=\"w-12\">Trend</TableHead>}\n                {showRisk && <TableHead className=\"w-24\">Risk</TableHead>}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {sortedData.map((customer) => {\n                const isExpanded = expandedRows.has(customer.id)\n                const hasOverdue =\n                  customer.buckets.days30 > 0 ||\n                  customer.buckets.days60 > 0 ||\n                  customer.buckets.days90 > 0 ||\n                  customer.buckets.days90Plus > 0\n\n                return (\n                  <React.Fragment key={customer.id}>\n                    <TableRow\n                      className={cn(\n                        hasOverdue && \"bg-red-50/50 dark:bg-red-950/20\",\n                        onCustomerClick && \"cursor-pointer hover:bg-muted/50\"\n                      )}\n                    >\n                      {collapsible && (\n                        <TableCell className=\"w-8\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 w-6 p-0\"\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              toggleRow(customer.id)\n                            }}\n                          >\n                            {isExpanded ? (\n                              <ChevronDown className=\"h-4 w-4\" />\n                            ) : (\n                              <ChevronRight className=\"h-4 w-4\" />\n                            )}\n                          </Button>\n                        </TableCell>\n                      )}\n                      <TableCell\n                        onClick={() => onCustomerClick?.(customer)}\n                        className=\"font-medium\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <span>{customer.name}</span>\n                          {customer.code && (\n                            <span className=\"text-xs text-muted-foreground\">\n                              ({customer.code})\n                            </span>\n                          )}\n                          {onCustomerClick && (\n                            <ExternalLink className=\"h-3 w-3 text-muted-foreground\" />\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                        {formatCurrency(customer.totalOutstanding, currency)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-green-600\">\n                        {formatCurrency(customer.buckets.current, currency)}\n                      </TableCell>\n                      <TableCell\n                        className={cn(\n                          \"text-right\",\n                          customer.buckets.days30 > 0 && \"text-amber-600\"\n                        )}\n                      >\n                        {formatCurrency(customer.buckets.days30, currency)}\n                      </TableCell>\n                      <TableCell\n                        className={cn(\n                          \"text-right\",\n                          customer.buckets.days60 > 0 && \"text-orange-600\"\n                        )}\n                      >\n                        {formatCurrency(customer.buckets.days60, currency)}\n                      </TableCell>\n                      <TableCell\n                        className={cn(\n                          \"text-right\",\n                          customer.buckets.days90 > 0 && \"text-red-600\"\n                        )}\n                      >\n                        {formatCurrency(customer.buckets.days90, currency)}\n                      </TableCell>\n                      <TableCell\n                        className={cn(\n                          \"text-right\",\n                          customer.buckets.days90Plus > 0 && \"font-semibold text-red-700\"\n                        )}\n                      >\n                        {formatCurrency(customer.buckets.days90Plus, currency)}\n                      </TableCell>\n                      {showTrends && (\n                        <TableCell>\n                          <TrendIndicator trend={customer.trend} />\n                        </TableCell>\n                      )}\n                      {showRisk && (\n                        <TableCell>\n                          <RiskBadge level={customer.riskLevel} />\n                        </TableCell>\n                      )}\n                    </TableRow>\n\n                    {/* Expanded Details Row */}\n                    {collapsible && isExpanded && (\n                      <TableRow className=\"bg-muted/30\">\n                        <TableCell colSpan={showTrends && showRisk ? 11 : showTrends || showRisk ? 10 : 9}>\n                          <div className=\"grid gap-4 px-4 py-3 md:grid-cols-4\">\n                            {customer.creditLimit !== undefined && (\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Credit Limit</p>\n                                <p className=\"font-medium\">\n                                  {formatCurrency(customer.creditLimit, currency)}\n                                </p>\n                                {customer.totalOutstanding > customer.creditLimit && (\n                                  <Badge variant=\"destructive\" className=\"mt-1 text-xs\">\n                                    Over Limit\n                                  </Badge>\n                                )}\n                              </div>\n                            )}\n                            {customer.paymentTerms && (\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Payment Terms</p>\n                                <p className=\"font-medium\">{customer.paymentTerms}</p>\n                              </div>\n                            )}\n                            {customer.lastPaymentDate && (\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Last Payment</p>\n                                <p className=\"font-medium\">\n                                  {new Date(customer.lastPaymentDate).toLocaleDateString()}\n                                  {customer.lastPaymentAmount && (\n                                    <span className=\"text-muted-foreground\">\n                                      {\" \"}\n                                      ({formatCurrency(customer.lastPaymentAmount, currency)})\n                                    </span>\n                                  )}\n                                </p>\n                              </div>\n                            )}\n                            <div className=\"flex items-end\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => onCustomerClick?.(customer)}\n                              >\n                                View Details\n                                <ExternalLink className=\"ml-2 h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </React.Fragment>\n                )\n              })}\n\n              {/* Totals Row */}\n              <TableRow className=\"bg-muted/50 font-semibold\">\n                {collapsible && <TableCell />}\n                <TableCell>Total ({summary.customerCount} customers)</TableCell>\n                <TableCell className=\"text-right\">\n                  {formatCurrency(summary.totalOutstanding, currency)}\n                </TableCell>\n                <TableCell className=\"text-right text-green-600\">\n                  {formatCurrency(summary.totalCurrent, currency)}\n                </TableCell>\n                <TableCell className=\"text-right text-amber-600\">\n                  {formatCurrency(summary.total30, currency)}\n                </TableCell>\n                <TableCell className=\"text-right text-orange-600\">\n                  {formatCurrency(summary.total60, currency)}\n                </TableCell>\n                <TableCell className=\"text-right text-red-600\">\n                  {formatCurrency(summary.total90, currency)}\n                </TableCell>\n                <TableCell className=\"text-right text-red-700\">\n                  {formatCurrency(summary.total90Plus, currency)}\n                </TableCell>\n                {showTrends && <TableCell />}\n                {showRisk && <TableCell />}\n              </TableRow>\n            </TableBody>\n          </Table>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { CustomerAging, ARAgingSummary }\n// AgingBucket is re-exported from blocks/types.ts\n"
    }
  ]
}