{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "danger-zone-indicator",
  "type": "registry:block",
  "title": "Danger Zone Indicator (Audit)",
  "description": "Policy violation warning system with severity levels, violation details, and override workflow",
  "categories": [
    "audit",
    "compliance",
    "alerts"
  ],
  "registryDependencies": [
    "alert",
    "card",
    "badge",
    "dialog"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/audit/danger-zone-indicator.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Danger Zone Indicator - Audit Component\n *\n * \"Danger Zone, Not Dead End\" — warn and record, don't block legitimate business needs.\n * Implements A01-CANONICAL.md §5 — Nexus Doctrine\n *\n * Features:\n * - Risk score visualization (0-100)\n * - Policy violations list\n * - Override justification capture\n * - Approval workflow integration\n *\n * @example\n * ```tsx\n * import { DangerZoneIndicator } from \"@workspace/design-system\"\n *\n * <DangerZoneIndicator\n *   riskScore={75}\n *   violations={[\n *     { id: \"credit\", name: \"Credit Limit Exceeded\", severity: \"warning\" },\n *     { id: \"approval\", name: \"Missing Approval\", severity: \"error\" },\n *   ]}\n *   onOverride={async (justification) => {\n *     await submitOverride(justification)\n *   }}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Textarea } from \"@/components/textarea\"\nimport { Label } from \"@/components/label\"\nimport { Progress } from \"@/components/progress\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/dialog\"\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/select\"\nimport {\n  AlertTriangle,\n  Shield,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Info,\n  Loader2,\n  ArrowRight,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type ViolationSeverity = \"info\" | \"warning\" | \"error\" | \"critical\"\n\nexport interface PolicyViolation {\n  id: string\n  name: string\n  description?: string\n  severity: ViolationSeverity\n  threshold?: string\n  currentValue?: string\n}\n\n// OverrideReason imported from shared types to avoid conflicts\nimport type { OverrideReason } from \"../types\"\n\nexport interface DangerZoneIndicatorProps {\n  /** Risk score (0-100) */\n  riskScore: number\n  /** List of policy violations */\n  violations: PolicyViolation[]\n  /** Override callback - called when user submits override */\n  onOverride?: (data: { reasonId: string; justification: string }) => Promise<void>\n  /** Cancel callback */\n  onCancel?: () => void\n  /** Proceed callback (when risk is acceptable) */\n  onProceed?: () => void\n  /** Available override reasons */\n  overrideReasons?: OverrideReason[]\n  /** Allow override even at high risk */\n  allowOverride?: boolean\n  /** Require approval for override */\n  requireApproval?: boolean\n  /** Current approver name (if awaiting approval) */\n  approver?: string\n  /** Display variant */\n  variant?: \"banner\" | \"card\" | \"inline\" | \"dialog\"\n  /** Custom className */\n  className?: string\n  /** Children (content to wrap) */\n  children?: React.ReactNode\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst DEFAULT_OVERRIDE_REASONS: OverrideReason[] = [\n  { id: \"customer_request\", label: \"Customer Request\", requiresJustification: true },\n  { id: \"management_approval\", label: \"Management Approval\", requiresJustification: true },\n  { id: \"one_time_exception\", label: \"One-Time Exception\", requiresJustification: true },\n  { id: \"data_correction\", label: \"Data Correction in Progress\", requiresJustification: false },\n  { id: \"other\", label: \"Other\", requiresJustification: true },\n]\n\nconst SEVERITY_CONFIG: Record<\n  ViolationSeverity,\n  {\n    icon: React.ComponentType<{ className?: string }>\n    color: string\n    bgColor: string\n    borderColor: string\n  }\n> = {\n  info: {\n    icon: Info,\n    color: \"text-blue-600\",\n    bgColor: \"bg-blue-50 dark:bg-blue-950/50\",\n    borderColor: \"border-blue-200 dark:border-blue-800\",\n  },\n  warning: {\n    icon: AlertCircle,\n    color: \"text-amber-600\",\n    bgColor: \"bg-amber-50 dark:bg-amber-950/50\",\n    borderColor: \"border-amber-200 dark:border-amber-800\",\n  },\n  error: {\n    icon: AlertTriangle,\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50 dark:bg-red-950/50\",\n    borderColor: \"border-red-200 dark:border-red-800\",\n  },\n  critical: {\n    icon: XCircle,\n    color: \"text-red-700\",\n    bgColor: \"bg-red-100 dark:bg-red-950\",\n    borderColor: \"border-red-300 dark:border-red-700\",\n  },\n}\n\n// ============================================================================\n// Helper Components\n// ============================================================================\n\nfunction RiskScoreMeter({ score }: { score: number }) {\n  const getColor = () => {\n    if (score < 30) return \"bg-green-500\"\n    if (score < 50) return \"bg-yellow-500\"\n    if (score < 75) return \"bg-orange-500\"\n    return \"bg-red-500\"\n  }\n\n  const getLabel = () => {\n    if (score < 30) return \"Low Risk\"\n    if (score < 50) return \"Medium Risk\"\n    if (score < 75) return \"High Risk\"\n    return \"Critical Risk\"\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between text-sm\">\n        <span className=\"text-muted-foreground\">Risk Score</span>\n        <span className=\"font-semibold\">{score}/100</span>\n      </div>\n      <div className=\"relative h-3 w-full overflow-hidden rounded-full bg-muted\">\n        <div\n          className={cn(\"h-full transition-all duration-500\", getColor())}\n          style={{ width: `${score}%` }}\n        />\n      </div>\n      <div className=\"flex justify-between text-xs text-muted-foreground\">\n        <span>Safe</span>\n        <span className=\"font-medium\">{getLabel()}</span>\n        <span>Critical</span>\n      </div>\n    </div>\n  )\n}\n\nfunction ViolationList({ violations }: { violations: PolicyViolation[] }) {\n  return (\n    <div className=\"space-y-2\">\n      <h4 className=\"text-sm font-medium\">Policy Violations</h4>\n      <ul className=\"space-y-2\">\n        {violations.map((violation) => {\n          const config = SEVERITY_CONFIG[violation.severity]\n          const Icon = config.icon\n          return (\n            <li\n              key={violation.id}\n              className={cn(\n                \"flex items-start gap-3 rounded-lg border p-3\",\n                config.bgColor,\n                config.borderColor\n              )}\n            >\n              <Icon className={cn(\"mt-0.5 h-4 w-4 shrink-0\", config.color)} />\n              <div className=\"flex-1 min-w-0\">\n                <p className={cn(\"font-medium text-sm\", config.color)}>\n                  {violation.name}\n                </p>\n                {violation.description && (\n                  <p className=\"text-xs text-muted-foreground mt-0.5\">\n                    {violation.description}\n                  </p>\n                )}\n                {(violation.threshold || violation.currentValue) && (\n                  <div className=\"flex gap-3 mt-1 text-xs\">\n                    {violation.threshold && (\n                      <span className=\"text-muted-foreground\">\n                        Threshold: <strong>{violation.threshold}</strong>\n                      </span>\n                    )}\n                    {violation.currentValue && (\n                      <span className=\"text-muted-foreground\">\n                        Current: <strong className={config.color}>{violation.currentValue}</strong>\n                      </span>\n                    )}\n                  </div>\n                )}\n              </div>\n              <Badge\n                variant={violation.severity === \"critical\" ? \"destructive\" : \"secondary\"}\n                className=\"shrink-0\"\n              >\n                {violation.severity.toUpperCase()}\n              </Badge>\n            </li>\n          )\n        })}\n      </ul>\n    </div>\n  )\n}\n\n// ============================================================================\n// Override Dialog Content\n// ============================================================================\n\nfunction OverrideDialogContent({\n  violations,\n  riskScore,\n  overrideReasons,\n  onOverride,\n  onClose,\n}: {\n  violations: PolicyViolation[]\n  riskScore: number\n  overrideReasons: OverrideReason[]\n  onOverride: (data: { reasonId: string; justification: string }) => Promise<void>\n  onClose: () => void\n}) {\n  const [reasonId, setReasonId] = React.useState(\"\")\n  const [justification, setJustification] = React.useState(\"\")\n  const [isSubmitting, setIsSubmitting] = React.useState(false)\n\n  const selectedReason = overrideReasons.find((r) => r.id === reasonId)\n  const requiresJustification = selectedReason?.requiresJustification ?? true\n  const canSubmit = reasonId && (!requiresJustification || justification.trim().length > 0)\n\n  const handleSubmit = async () => {\n    if (!canSubmit) return\n    setIsSubmitting(true)\n    try {\n      await onOverride({ reasonId, justification })\n      onClose()\n    } catch (error) {\n      console.error(\"Override failed:\", error)\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  return (\n    <>\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center gap-2\">\n          <Shield className=\"h-5 w-5 text-amber-500\" />\n          Override Policy Violations\n        </DialogTitle>\n        <DialogDescription>\n          You are about to override {violations.length} policy violation(s) with a risk score of {riskScore}/100.\n          This action will be recorded in the audit log.\n        </DialogDescription>\n      </DialogHeader>\n\n      <div className=\"space-y-4 py-4\">\n        <RiskScoreMeter score={riskScore} />\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"override-reason\">Reason for Override *</Label>\n          <Select value={reasonId} onValueChange={(v) => v && setReasonId(v)}>\n            <SelectTrigger id=\"override-reason\">\n              <SelectValue placeholder=\"Select a reason...\" />\n            </SelectTrigger>\n            <SelectContent>\n              {overrideReasons.map((reason) => (\n                <SelectItem key={reason.id} value={reason.id}>\n                  {reason.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {requiresJustification && (\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"justification\">Justification *</Label>\n            <Textarea\n              id=\"justification\"\n              placeholder=\"Please provide a detailed justification for this override...\"\n              value={justification}\n              onChange={(e) => setJustification(e.target.value)}\n              rows={4}\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              This justification will be recorded and may be reviewed during audits.\n            </p>\n          </div>\n        )}\n      </div>\n\n      <DialogFooter>\n        <Button variant=\"outline\" onClick={onClose}>\n          Cancel\n        </Button>\n        <Button\n          variant=\"destructive\"\n          onClick={handleSubmit}\n          disabled={!canSubmit || isSubmitting}\n        >\n          {isSubmitting ? (\n            <>\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              Processing...\n            </>\n          ) : (\n            <>\n              <Shield className=\"mr-2 h-4 w-4\" />\n              Override & Proceed\n            </>\n          )}\n        </Button>\n      </DialogFooter>\n    </>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function DangerZoneIndicator({\n  riskScore,\n  violations,\n  onOverride,\n  onCancel,\n  onProceed,\n  overrideReasons = DEFAULT_OVERRIDE_REASONS,\n  allowOverride = true,\n  requireApproval = false,\n  approver,\n  variant = \"card\",\n  className,\n  children,\n}: DangerZoneIndicatorProps) {\n  const [showOverrideDialog, setShowOverrideDialog] = React.useState(false)\n\n  const hasCritical = violations.some((v) => v.severity === \"critical\")\n  const canOverride = allowOverride && !hasCritical && onOverride\n\n  const handleOverride = async (data: { reasonId: string; justification: string }) => {\n    if (onOverride) {\n      await onOverride(data)\n    }\n  }\n\n  // Banner variant\n  if (variant === \"banner\") {\n    return (\n      <div\n        className={cn(\n          \"flex items-center gap-4 rounded-lg border border-destructive/50 bg-destructive/10 px-4 py-3\",\n          className\n        )}\n      >\n        <AlertTriangle className=\"h-5 w-5 text-destructive shrink-0\" />\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"font-medium text-destructive\">\n            Danger Zone: {violations.length} violation(s) detected\n          </p>\n          <p className=\"text-sm text-muted-foreground\">\n            Risk score: {riskScore}/100\n          </p>\n        </div>\n        {canOverride && (\n          <Dialog open={showOverrideDialog} onOpenChange={setShowOverrideDialog}>\n            <DialogTrigger>\n              <Button variant=\"outline\" size=\"sm\">\n                Override\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <OverrideDialogContent\n                violations={violations}\n                riskScore={riskScore}\n                overrideReasons={overrideReasons}\n                onOverride={handleOverride}\n                onClose={() => setShowOverrideDialog(false)}\n              />\n            </DialogContent>\n          </Dialog>\n        )}\n        {onCancel && (\n          <Button variant=\"ghost\" size=\"sm\" onClick={onCancel}>\n            Cancel\n          </Button>\n        )}\n      </div>\n    )\n  }\n\n  // Inline variant\n  if (variant === \"inline\") {\n    return (\n      <div className={cn(\"flex items-center gap-2\", className)}>\n        <Badge variant=\"destructive\" className=\"gap-1\">\n          <AlertTriangle className=\"h-3 w-3\" />\n          Risk: {riskScore}\n        </Badge>\n        {violations.length > 0 && (\n          <span className=\"text-xs text-muted-foreground\">\n            {violations.length} violation(s)\n          </span>\n        )}\n      </div>\n    )\n  }\n\n  // Dialog variant (wraps children)\n  if (variant === \"dialog\" && children) {\n    return (\n      <Dialog>\n        <DialogTrigger>{children}</DialogTrigger>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-destructive\">\n              <AlertTriangle className=\"h-5 w-5\" />\n              Danger Zone Detected\n            </DialogTitle>\n            <DialogDescription>\n              This action has triggered policy warnings. Please review before proceeding.\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <RiskScoreMeter score={riskScore} />\n            <ViolationList violations={violations} />\n          </div>\n\n          <DialogFooter className=\"gap-2\">\n            {onCancel && (\n              <Button variant=\"outline\" onClick={onCancel}>\n                Cancel\n              </Button>\n            )}\n            {canOverride && (\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowOverrideDialog(true)}\n              >\n                Request Override\n              </Button>\n            )}\n            {riskScore < 50 && onProceed && (\n              <Button onClick={onProceed}>\n                Acknowledge & Proceed\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    )\n  }\n\n  // Default: Card variant\n  return (\n    <Card className={cn(\"border-destructive/50\", className)}>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2 text-destructive\">\n          <AlertTriangle className=\"h-5 w-5\" />\n          Danger Zone\n        </CardTitle>\n        <CardDescription>\n          This action has triggered policy warnings. Review before proceeding.\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <RiskScoreMeter score={riskScore} />\n        <ViolationList violations={violations} />\n\n        {requireApproval && approver && (\n          <div className=\"flex items-center gap-2 rounded-lg bg-muted p-3 text-sm\">\n            <Shield className=\"h-4 w-4 text-amber-500\" />\n            <span>Awaiting approval from: <strong>{approver}</strong></span>\n          </div>\n        )}\n\n        <div className=\"flex gap-2 pt-2\">\n          {onCancel && (\n            <Button variant=\"outline\" onClick={onCancel}>\n              Cancel\n            </Button>\n          )}\n          {canOverride && (\n            <Dialog open={showOverrideDialog} onOpenChange={setShowOverrideDialog}>\n              <DialogTrigger>\n                <Button variant=\"outline\">\n                  <Shield className=\"mr-2 h-4 w-4\" />\n                  Request Override\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <OverrideDialogContent\n                  violations={violations}\n                  riskScore={riskScore}\n                  overrideReasons={overrideReasons}\n                  onOverride={handleOverride}\n                  onClose={() => setShowOverrideDialog(false)}\n                />\n              </DialogContent>\n            </Dialog>\n          )}\n          {riskScore < 50 && onProceed && (\n            <Button variant=\"default\" onClick={onProceed}>\n              <CheckCircle className=\"mr-2 h-4 w-4\" />\n              Acknowledge & Proceed\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { ViolationSeverity, PolicyViolation }\n// OverrideReason is re-exported from blocks/types.ts\n"
    }
  ]
}