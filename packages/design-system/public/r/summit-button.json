{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "summit-button",
  "type": "registry:block",
  "title": "SUMMIT Button (Cobalt)",
  "description": "Multi-step workflow button implementing S.U.M.M.I.T. protocol (Save, Upload, Message, Migrate, Integrate, Terminate)",
  "categories": [
    "cobalt",
    "execution",
    "workflow"
  ],
  "registryDependencies": [
    "button",
    "tooltip",
    "progress"
  ],
  "dependencies": [
    "motion"
  ],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/cobalt/summit-button.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * SUMMIT Button - Cobalt Kernel Single-Action Workflow\n *\n * One button that completes an entire workflow.\n * Implements A01-CANONICAL.md §4 — \"One tap, done\"\n *\n * Features:\n * - Pre-validation before execution\n * - Progress indicators with step descriptions\n * - Rollback on error\n * - Success celebration (confetti)\n * - Automatic audit trail\n *\n * @example\n * ```tsx\n * import { SUMMITButton } from \"@workspace/design-system\"\n *\n * <SUMMITButton\n *   label=\"Post Invoice\"\n *   steps={[\n *     { id: \"validate\", label: \"Validating...\" },\n *     { id: \"post\", label: \"Posting to ledger...\" },\n *     { id: \"email\", label: \"Sending email...\" },\n *     { id: \"complete\", label: \"Complete!\" },\n *   ]}\n *   onExecute={async (onProgress) => {\n *     onProgress(\"validate\")\n *     await validateInvoice()\n *     onProgress(\"post\")\n *     await postToLedger()\n *     onProgress(\"email\")\n *     await sendEmail()\n *     onProgress(\"complete\")\n *   }}\n *   onSuccess={() => toast.success(\"Invoice posted!\")}\n *   onError={(error) => toast.error(error.message)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/button\"\nimport { Progress } from \"@/components/progress\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/alert-dialog\"\nimport {\n  Check,\n  Loader2,\n  AlertTriangle,\n  XCircle,\n  Zap,\n} from \"lucide-react\"\nimport { Confetti, type ConfettiRef } from \"@/effects/confetti\"\n\n// Button props type\ntype ButtonProps = React.ComponentPropsWithoutRef<typeof Button>\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface SUMMITStep {\n  id: string\n  label: string\n  description?: string\n}\n\nexport interface SUMMITButtonProps extends Omit<ButtonProps, \"onClick\" | \"onError\"> {\n  /** Button label */\n  label: string\n  /** Execution steps with labels */\n  steps: SUMMITStep[]\n  /** Main execution function - receives progress callback */\n  onExecute: (onProgress: (stepId: string) => void) => Promise<void>\n  /** Success callback */\n  onSuccess?: () => void\n  /** Error callback */\n  onError?: (error: Error) => void\n  /** Rollback function (called on error) */\n  onRollback?: () => Promise<void>\n  /** Show confirmation dialog before execution */\n  requireConfirmation?: boolean\n  /** Confirmation dialog title */\n  confirmTitle?: string\n  /** Confirmation dialog description */\n  confirmDescription?: string\n  /** Show confetti on success */\n  showConfetti?: boolean\n  /** Icon to show */\n  icon?: React.ComponentType<{ className?: string }>\n  /** Danger mode (destructive styling) */\n  danger?: boolean\n  /** Disabled state */\n  disabled?: boolean\n}\n\ntype ExecutionState = \"idle\" | \"executing\" | \"success\" | \"error\"\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport function SUMMITButton({\n  label,\n  steps,\n  onExecute,\n  onSuccess,\n  onError,\n  onRollback,\n  requireConfirmation = false,\n  confirmTitle = \"Confirm Action\",\n  confirmDescription = \"Are you sure you want to proceed with this action?\",\n  showConfetti = true,\n  icon: Icon = Zap,\n  danger = false,\n  disabled = false,\n  className,\n  ...buttonProps\n}: SUMMITButtonProps) {\n  const [state, setState] = React.useState<ExecutionState>(\"idle\")\n  const [currentStepId, setCurrentStepId] = React.useState<string | null>(null)\n  const [errorMessage, setErrorMessage] = React.useState<string | null>(null)\n  const [showConfirmDialog, setShowConfirmDialog] = React.useState(false)\n  const confettiRef = React.useRef<ConfettiRef>(null)\n\n  const currentStepIndex = steps.findIndex((s) => s.id === currentStepId)\n  const progress = currentStepId\n    ? Math.round(((currentStepIndex + 1) / steps.length) * 100)\n    : 0\n  const currentStep = steps.find((s) => s.id === currentStepId)\n\n  const handleProgress = React.useCallback((stepId: string) => {\n    setCurrentStepId(stepId)\n  }, [])\n\n  const execute = React.useCallback(async () => {\n    setState(\"executing\")\n    setCurrentStepId(steps[0]?.id || null)\n    setErrorMessage(null)\n\n    try {\n      await onExecute(handleProgress)\n      setState(\"success\")\n\n      if (showConfetti && confettiRef.current) {\n        confettiRef.current.fire({\n          particleCount: 100,\n          spread: 70,\n          origin: { y: 0.6 },\n        })\n      }\n\n      onSuccess?.()\n\n      // Reset after success animation\n      globalThis.setTimeout(() => {\n        setState(\"idle\")\n        setCurrentStepId(null)\n      }, 2000)\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error))\n      setState(\"error\")\n      setErrorMessage(err.message)\n      onError?.(err)\n\n      // Attempt rollback if provided\n      if (onRollback) {\n        try {\n          await onRollback()\n        } catch {\n          // Rollback failed silently - original error is preserved\n        }\n      }\n\n      // Reset after error display\n      globalThis.setTimeout(() => {\n        setState(\"idle\")\n        setCurrentStepId(null)\n        setErrorMessage(null)\n      }, 3000)\n    }\n  }, [steps, onExecute, handleProgress, showConfetti, onSuccess, onError, onRollback])\n\n  const handleClick = React.useCallback(() => {\n    if (requireConfirmation) {\n      setShowConfirmDialog(true)\n    } else {\n      execute()\n    }\n  }, [requireConfirmation, execute])\n\n  const handleConfirm = React.useCallback(() => {\n    setShowConfirmDialog(false)\n    execute()\n  }, [execute])\n\n  const isExecuting = state === \"executing\"\n  const isSuccess = state === \"success\"\n  const isError = state === \"error\"\n\n  // Determine button variant\n  const getVariant = (): ButtonProps[\"variant\"] => {\n    if (isSuccess) return \"default\"\n    if (isError) return \"destructive\"\n    if (danger) return \"destructive\"\n    return \"default\"\n  }\n\n  // Determine icon\n  const getIcon = () => {\n    if (isExecuting) return <Loader2 className=\"h-4 w-4 animate-spin\" />\n    if (isSuccess) return <Check className=\"h-4 w-4\" />\n    if (isError) return <XCircle className=\"h-4 w-4\" />\n    return <Icon className=\"h-4 w-4\" />\n  }\n\n  // Determine label\n  const getLabel = () => {\n    if (isExecuting && currentStep) return currentStep.label\n    if (isSuccess) return \"Complete!\"\n    if (isError) return \"Failed\"\n    return label\n  }\n\n  return (\n    <>\n      {/* Confetti overlay */}\n      {showConfetti && <Confetti ref={confettiRef} className=\"pointer-events-none fixed inset-0 z-50\" />}\n\n      {/* Confirmation Dialog */}\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2\">\n              {danger && <AlertTriangle className=\"h-5 w-5 text-destructive\" />}\n              {confirmTitle}\n            </AlertDialogTitle>\n            <AlertDialogDescription>{confirmDescription}</AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirm}\n              className={cn(danger && \"bg-destructive text-destructive-foreground hover:bg-destructive/90\")}\n            >\n              Confirm\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Main Button */}\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger>\n            <div className=\"relative inline-block\">\n              <Button\n                variant={getVariant()}\n                disabled={disabled || isExecuting}\n                onClick={handleClick}\n                className={cn(\n                  \"relative min-w-[140px] transition-all duration-300\",\n                  isExecuting && \"cursor-wait\",\n                  isSuccess && \"bg-green-600 hover:bg-green-600\",\n                  className\n                )}\n                {...buttonProps}\n              >\n                <span className=\"flex items-center gap-2\">\n                  {getIcon()}\n                  <span>{getLabel()}</span>\n                </span>\n              </Button>\n\n              {/* Progress indicator */}\n              {isExecuting && (\n                <div className=\"absolute -bottom-1 left-0 right-0 px-1\">\n                  <Progress value={progress} className=\"h-1\" />\n                </div>\n              )}\n            </div>\n          </TooltipTrigger>\n          <TooltipContent side=\"bottom\" className=\"max-w-xs\">\n            {isExecuting && currentStep?.description ? (\n              <div>\n                <p className=\"font-medium\">{currentStep.label}</p>\n                <p className=\"text-xs text-muted-foreground\">{currentStep.description}</p>\n              </div>\n            ) : isError && errorMessage ? (\n              <div className=\"text-destructive\">\n                <p className=\"font-medium\">Error</p>\n                <p className=\"text-xs\">{errorMessage}</p>\n              </div>\n            ) : (\n              <div>\n                <p className=\"font-medium\">{label}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {steps.length} step{steps.length !== 1 ? \"s\" : \"\"} to complete\n                </p>\n              </div>\n            )}\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    </>\n  )\n}\n\n// ============================================================================\n// Preset SUMMIT Buttons (ERP-focused)\n// ============================================================================\n\nexport interface PresetSUMMITProps extends Omit<SUMMITButtonProps, \"label\" | \"steps\" | \"onExecute\"> {\n  onExecute: (onProgress: (stepId: string) => void) => Promise<void>\n}\n\n/** Post Invoice SUMMIT Button */\nexport function SUMMITPostInvoice(props: PresetSUMMITProps) {\n  return (\n    <SUMMITButton\n      label=\"Post Invoice\"\n      steps={[\n        { id: \"validate\", label: \"Validating...\", description: \"Checking invoice details and totals\" },\n        { id: \"post\", label: \"Posting...\", description: \"Creating ledger entries\" },\n        { id: \"ar\", label: \"Updating AR...\", description: \"Recording accounts receivable\" },\n        { id: \"email\", label: \"Sending...\", description: \"Emailing invoice to customer\" },\n        { id: \"complete\", label: \"Complete!\", description: \"Invoice posted successfully\" },\n      ]}\n      confirmTitle=\"Post Invoice\"\n      confirmDescription=\"This will post the invoice to the ledger and update accounts receivable. This action cannot be undone.\"\n      requireConfirmation\n      {...props}\n    />\n  )\n}\n\n/** Approve All SUMMIT Button */\nexport function SUMMITApproveAll(props: PresetSUMMITProps) {\n  return (\n    <SUMMITButton\n      label=\"Approve All\"\n      icon={Check}\n      steps={[\n        { id: \"validate\", label: \"Validating...\", description: \"Checking approval requirements\" },\n        { id: \"approve\", label: \"Approving...\", description: \"Processing approvals\" },\n        { id: \"notify\", label: \"Notifying...\", description: \"Sending notifications\" },\n        { id: \"complete\", label: \"Complete!\", description: \"All items approved\" },\n      ]}\n      confirmTitle=\"Approve All Items\"\n      confirmDescription=\"This will approve all pending items in the queue. Are you sure?\"\n      requireConfirmation\n      {...props}\n    />\n  )\n}\n\n/** Receive Stock SUMMIT Button */\nexport function SUMMITReceiveStock(props: PresetSUMMITProps) {\n  return (\n    <SUMMITButton\n      label=\"Receive Stock\"\n      steps={[\n        { id: \"scan\", label: \"Scanning...\", description: \"Reading barcode data\" },\n        { id: \"validate\", label: \"Validating...\", description: \"Checking against PO\" },\n        { id: \"move\", label: \"Creating movement...\", description: \"Recording stock movement\" },\n        { id: \"update\", label: \"Updating inventory...\", description: \"Adjusting stock levels\" },\n        { id: \"complete\", label: \"Complete!\", description: \"Stock received\" },\n      ]}\n      {...props}\n    />\n  )\n}\n\n/** Close Period SUMMIT Button */\nexport function SUMMITClosePeriod(props: PresetSUMMITProps) {\n  return (\n    <SUMMITButton\n      label=\"Close Period\"\n      danger\n      steps={[\n        { id: \"validate\", label: \"Validating...\", description: \"Checking for open items\" },\n        { id: \"reconcile\", label: \"Reconciling...\", description: \"Verifying subledger balances\" },\n        { id: \"close\", label: \"Closing...\", description: \"Locking the period\" },\n        { id: \"report\", label: \"Generating report...\", description: \"Creating period close report\" },\n        { id: \"complete\", label: \"Complete!\", description: \"Period closed\" },\n      ]}\n      confirmTitle=\"Close Fiscal Period\"\n      confirmDescription=\"This will close the current fiscal period. No further postings will be allowed. This action cannot be undone.\"\n      requireConfirmation\n      {...props}\n    />\n  )\n}\n"
    }
  ]
}