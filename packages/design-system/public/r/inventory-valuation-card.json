{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "inventory-valuation-card",
  "type": "registry:block",
  "title": "Inventory Valuation Card (ERP)",
  "description": "Stock valuation display with costing method, stock level indicators, and reorder alerts",
  "categories": [
    "erp",
    "accounting",
    "inventory"
  ],
  "registryDependencies": [
    "card",
    "badge",
    "progress"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/erp/inventory-valuation-card.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Inventory Valuation Card - ERP Domain Component\n *\n * Stock valuation and costing method display.\n * Implements A01-CANONICAL.md §3 — Three Pillars (Goods)\n *\n * Features:\n * - On-hand quantity display\n * - Valuation amount with costing method\n * - Cost per unit\n * - Stock level indicators\n * - Movement history link\n *\n * @example\n * ```tsx\n * import { InventoryValuationCard } from \"@workspace/design-system\"\n *\n * <InventoryValuationCard\n *   item={inventoryItem}\n *   onViewMovements={(itemId) => router.push(`/inventory/${itemId}/movements`)}\n *   onAdjust={(itemId) => openAdjustmentModal(itemId)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Progress } from \"@/components/progress\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  Package,\n  TrendingUp,\n  TrendingDown,\n  AlertTriangle,\n  ArrowRight,\n  History,\n  Edit,\n  BarChart3,\n  DollarSign,\n  Box,\n  AlertCircle,\n  CheckCircle,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type CostingMethod = \"fifo\" | \"lifo\" | \"weighted_avg\" | \"standard\" | \"specific\"\nexport type StockLevel = \"out_of_stock\" | \"low\" | \"normal\" | \"overstock\"\n\nexport interface InventoryItem {\n  id: string\n  sku: string\n  name: string\n  description?: string\n  category?: string\n  onHand: number\n  unit: string\n  unitCost: number\n  totalValue: number\n  costingMethod: CostingMethod\n  reorderPoint?: number\n  maxStock?: number\n  lastReceived?: string | Date\n  lastIssued?: string | Date\n  turnoverRate?: number // Annual turnover\n  daysOfStock?: number\n  trend?: {\n    direction: \"up\" | \"down\" | \"stable\"\n    percentage: number\n    period: string\n  }\n  alerts?: {\n    type: \"reorder\" | \"overstock\" | \"slow_moving\" | \"expired\"\n    message: string\n  }[]\n}\n\nexport interface InventoryValuationCardProps {\n  /** Inventory item data */\n  item: InventoryItem\n  /** View movements callback */\n  onViewMovements?: (itemId: string) => void\n  /** Adjust stock callback */\n  onAdjust?: (itemId: string) => void\n  /** View details callback */\n  onViewDetails?: (itemId: string) => void\n  /** Currency symbol */\n  currency?: string\n  /** Compact mode */\n  compact?: boolean\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst COSTING_LABELS: Record<CostingMethod, string> = {\n  fifo: \"FIFO\",\n  lifo: \"LIFO\",\n  weighted_avg: \"Weighted Avg\",\n  standard: \"Standard\",\n  specific: \"Specific ID\",\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction formatCurrency(amount: number, currency: string = \"$\"): string {\n  return `${currency}${amount.toLocaleString(\"en-US\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })}`\n}\n\nfunction getStockLevel(item: InventoryItem): StockLevel {\n  if (item.onHand === 0) return \"out_of_stock\"\n  if (item.reorderPoint && item.onHand <= item.reorderPoint) return \"low\"\n  if (item.maxStock && item.onHand >= item.maxStock) return \"overstock\"\n  return \"normal\"\n}\n\n// ============================================================================\n// Sub-components\n// ============================================================================\n\nfunction StockLevelIndicator({ level, quantity, unit }: { level: StockLevel; quantity: number; unit: string }) {\n  const config = {\n    out_of_stock: { color: \"text-red-600\", bg: \"bg-red-100\", label: \"Out of Stock\", icon: AlertCircle },\n    low: { color: \"text-amber-600\", bg: \"bg-amber-100\", label: \"Low Stock\", icon: AlertTriangle },\n    normal: { color: \"text-green-600\", bg: \"bg-green-100\", label: \"In Stock\", icon: CheckCircle },\n    overstock: { color: \"text-blue-600\", bg: \"bg-blue-100\", label: \"Overstock\", icon: Box },\n  }\n\n  const c = config[level]\n  const Icon = c.icon\n\n  return (\n    <div className={cn(\"inline-flex items-center gap-1.5 rounded-md px-2 py-1\", c.bg)}>\n      <Icon className={cn(\"h-4 w-4\", c.color)} />\n      <span className={cn(\"text-sm font-medium\", c.color)}>\n        {quantity.toLocaleString()} {unit}\n      </span>\n    </div>\n  )\n}\n\nfunction StockProgressBar({\n  onHand,\n  reorderPoint,\n  maxStock,\n}: {\n  onHand: number\n  reorderPoint?: number\n  maxStock?: number\n}) {\n  if (!maxStock) return null\n\n  const percentage = Math.min((onHand / maxStock) * 100, 100)\n  const reorderPercentage = reorderPoint ? (reorderPoint / maxStock) * 100 : 0\n\n  return (\n    <div className=\"space-y-1\">\n      <div className=\"relative h-2 w-full overflow-hidden rounded-full bg-muted\">\n        <div\n          className={cn(\n            \"h-full transition-all\",\n            percentage < reorderPercentage\n              ? \"bg-red-500\"\n              : percentage > 90\n              ? \"bg-blue-500\"\n              : \"bg-green-500\"\n          )}\n          style={{ width: `${percentage}%` }}\n        />\n        {reorderPoint && (\n          <div\n            className=\"absolute top-0 h-full w-0.5 bg-amber-500\"\n            style={{ left: `${reorderPercentage}%` }}\n          />\n        )}\n      </div>\n      <div className=\"flex justify-between text-xs text-muted-foreground\">\n        <span>0</span>\n        {reorderPoint && <span className=\"text-amber-600\">Reorder: {reorderPoint}</span>}\n        <span>Max: {maxStock}</span>\n      </div>\n    </div>\n  )\n}\n\nfunction TrendBadge({ trend }: { trend: InventoryItem[\"trend\"] }) {\n  if (!trend) return null\n\n  const Icon = trend.direction === \"up\" ? TrendingUp : trend.direction === \"down\" ? TrendingDown : null\n\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger>\n          <span\n            className={cn(\n              \"inline-flex items-center gap-1 text-xs\",\n              trend.direction === \"up\" && \"text-green-600\",\n              trend.direction === \"down\" && \"text-red-600\"\n            )}\n          >\n            {Icon && <Icon className=\"h-3 w-3\" />}\n            {trend.percentage > 0 ? \"+\" : \"\"}\n            {trend.percentage}%\n          </span>\n        </TooltipTrigger>\n        <TooltipContent>\n          <p>\n            {trend.direction === \"up\" ? \"Increased\" : \"Decreased\"} {trend.percentage}% vs {trend.period}\n          </p>\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  )\n}\n\nfunction AlertBadges({ alerts }: { alerts?: InventoryItem[\"alerts\"] }) {\n  if (!alerts || alerts.length === 0) return null\n\n  const alertConfig = {\n    reorder: { color: \"bg-amber-100 text-amber-700 border-amber-300\", icon: AlertTriangle },\n    overstock: { color: \"bg-blue-100 text-blue-700 border-blue-300\", icon: Box },\n    slow_moving: { color: \"bg-gray-100 text-gray-700 border-gray-300\", icon: TrendingDown },\n    expired: { color: \"bg-red-100 text-red-700 border-red-300\", icon: AlertCircle },\n  }\n\n  return (\n    <div className=\"flex flex-wrap gap-1\">\n      {alerts.map((alert, index) => {\n        const config = alertConfig[alert.type]\n        const Icon = config.icon\n        return (\n          <TooltipProvider key={index}>\n            <Tooltip>\n              <TooltipTrigger>\n                <span\n                  className={cn(\n                    \"inline-flex items-center gap-1 rounded border px-2 py-0.5 text-xs\",\n                    config.color\n                  )}\n                >\n                  <Icon className=\"h-3 w-3\" />\n                  {alert.type.replace(\"_\", \" \")}\n                </span>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>{alert.message}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        )\n      })}\n    </div>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function InventoryValuationCard({\n  item,\n  onViewMovements,\n  onAdjust,\n  onViewDetails,\n  currency = \"$\",\n  compact = false,\n  className,\n}: InventoryValuationCardProps) {\n  const stockLevel = getStockLevel(item)\n\n  return (\n    <Card className={cn(stockLevel === \"out_of_stock\" && \"border-red-300\", className)}>\n      <CardHeader className={cn(compact && \"pb-2\")}>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <CardTitle className=\"text-base\">{item.name}</CardTitle>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {item.sku}\n              </Badge>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {COSTING_LABELS[item.costingMethod]}\n              </Badge>\n            </div>\n            {item.description && !compact && (\n              <CardDescription className=\"mt-1\">{item.description}</CardDescription>\n            )}\n          </div>\n          <Package className=\"h-5 w-5 text-muted-foreground shrink-0\" />\n        </div>\n        <AlertBadges alerts={item.alerts} />\n      </CardHeader>\n\n      <CardContent className={cn(\"space-y-4\", compact && \"pt-0\")}>\n        {/* Stock Level */}\n        <div className=\"flex items-center justify-between\">\n          <StockLevelIndicator level={stockLevel} quantity={item.onHand} unit={item.unit} />\n          <TrendBadge trend={item.trend} />\n        </div>\n\n        {/* Stock Progress */}\n        {!compact && (\n          <StockProgressBar\n            onHand={item.onHand}\n            reorderPoint={item.reorderPoint}\n            maxStock={item.maxStock}\n          />\n        )}\n\n        {/* Valuation */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <p className=\"text-xs text-muted-foreground\">Unit Cost</p>\n            <p className=\"text-lg font-bold\">{formatCurrency(item.unitCost, currency)}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-muted-foreground\">Total Value</p>\n            <p className=\"text-lg font-bold\">{formatCurrency(item.totalValue, currency)}</p>\n          </div>\n        </div>\n\n        {/* Additional Metrics */}\n        {!compact && (\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n            {item.turnoverRate !== undefined && (\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Turnover Rate</p>\n                <p className=\"font-medium\">{item.turnoverRate.toFixed(1)}x / year</p>\n              </div>\n            )}\n            {item.daysOfStock !== undefined && (\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Days of Stock</p>\n                <p className=\"font-medium\">{item.daysOfStock} days</p>\n              </div>\n            )}\n            {item.lastReceived && (\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Last Received</p>\n                <p className=\"font-medium\">\n                  {new Date(item.lastReceived).toLocaleDateString()}\n                </p>\n              </div>\n            )}\n            {item.lastIssued && (\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Last Issued</p>\n                <p className=\"font-medium\">\n                  {new Date(item.lastIssued).toLocaleDateString()}\n                </p>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n\n      {/* Actions */}\n      <CardFooter className=\"gap-2\">\n        {onViewMovements && (\n          <Button variant=\"outline\" size=\"sm\" onClick={() => onViewMovements(item.id)}>\n            <History className=\"mr-1 h-3 w-3\" />\n            Movements\n          </Button>\n        )}\n        {onAdjust && (\n          <Button variant=\"outline\" size=\"sm\" onClick={() => onAdjust(item.id)}>\n            <Edit className=\"mr-1 h-3 w-3\" />\n            Adjust\n          </Button>\n        )}\n        {onViewDetails && (\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => onViewDetails(item.id)}>\n            Details\n            <ArrowRight className=\"ml-1 h-3 w-3\" />\n          </Button>\n        )}\n      </CardFooter>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Grid Component for Multiple Items\n// ============================================================================\n\nexport interface InventoryValuationGridProps {\n  /** Inventory items */\n  items: InventoryItem[]\n  /** View movements callback */\n  onViewMovements?: (itemId: string) => void\n  /** Adjust stock callback */\n  onAdjust?: (itemId: string) => void\n  /** View details callback */\n  onViewDetails?: (itemId: string) => void\n  /** Currency symbol */\n  currency?: string\n  /** Columns */\n  columns?: 2 | 3 | 4\n  /** Custom className */\n  className?: string\n}\n\nexport function InventoryValuationGrid({\n  items,\n  onViewMovements,\n  onAdjust,\n  onViewDetails,\n  currency = \"$\",\n  columns = 3,\n  className,\n}: InventoryValuationGridProps) {\n  const gridCols = {\n    2: \"md:grid-cols-2\",\n    3: \"md:grid-cols-2 lg:grid-cols-3\",\n    4: \"md:grid-cols-2 lg:grid-cols-4\",\n  }\n\n  // Summary stats\n  const totalValue = items.reduce((sum, item) => sum + item.totalValue, 0)\n  const outOfStock = items.filter((item) => item.onHand === 0).length\n  const lowStock = items.filter(\n    (item) => item.reorderPoint && item.onHand <= item.reorderPoint && item.onHand > 0\n  ).length\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Package className=\"h-5 w-5\" />\n          Inventory Valuation\n        </CardTitle>\n        <CardDescription>\n          {items.length} item{items.length !== 1 ? \"s\" : \"\"} •{\" \"}\n          Total: {formatCurrency(totalValue, currency)}\n          {outOfStock > 0 && (\n            <span className=\"text-red-600\"> • {outOfStock} out of stock</span>\n          )}\n          {lowStock > 0 && (\n            <span className=\"text-amber-600\"> • {lowStock} low stock</span>\n          )}\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className={cn(\"grid gap-4\", gridCols[columns])}>\n          {items.map((item) => (\n            <InventoryValuationCard\n              key={item.id}\n              item={item}\n              onViewMovements={onViewMovements}\n              onAdjust={onAdjust}\n              onViewDetails={onViewDetails}\n              currency={currency}\n              compact\n            />\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { CostingMethod, StockLevel, InventoryItem }\n"
    }
  ]
}