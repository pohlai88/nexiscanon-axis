{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "crud-sap-interface",
  "type": "registry:block",
  "title": "CRUD-SAP Interface (Cobalt)",
  "description": "Unified CRUD operations interface with global search, inline editing, AI-predicted actions, and pagination",
  "categories": [
    "cobalt",
    "execution",
    "data-management"
  ],
  "registryDependencies": [
    "table",
    "button",
    "input",
    "dialog"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/cobalt/crud-sap-interface.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * CRUD-SAP Interface - Cobalt Kernel Component\n *\n * Create, Read, Update, Delete, Search, Audit, Predict\n * Implements A01-CANONICAL.md §4 — Cobalt Kernel execution patterns\n *\n * Features:\n * - Unified CRUD operations\n * - Global search-first navigation\n * - Automatic audit logging\n * - AI-powered next action predictions\n * - Inline editing\n *\n * @example\n * ```tsx\n * import { CRUDSAPTable } from \"@workspace/design-system\"\n *\n * <CRUDSAPTable\n *   data={invoices}\n *   columns={invoiceColumns}\n *   onSearch={handleSearch}\n *   onCreate={() => openCreateModal()}\n *   onUpdate={(row) => saveChanges(row)}\n *   onDelete={(ids) => deleteRows(ids)}\n *   predictedActions={aiPredictions}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Input } from \"@/components/input\"\nimport { Checkbox } from \"@/components/checkbox\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/table\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/dropdown-menu\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/alert-dialog\"\nimport {\n  Search,\n  Plus,\n  Edit,\n  Trash2,\n  Eye,\n  History,\n  Sparkles,\n  MoreVertical,\n  ChevronLeft,\n  ChevronRight,\n  ChevronsLeft,\n  ChevronsRight,\n  ArrowUpDown,\n  Check,\n  X,\n  Loader2,\n  Zap,\n  Download,\n  Upload,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ColumnDef<T> {\n  id: string\n  header: string\n  accessorKey: keyof T | ((row: T) => unknown)\n  cell?: (row: T) => React.ReactNode\n  editable?: boolean\n  sortable?: boolean\n  width?: number | string\n}\n\nexport interface PredictedAction {\n  id: string\n  label: string\n  description?: string\n  confidence: number\n  action: () => void\n}\n\nexport interface CRUDSAPTableProps<T extends { id: string }> {\n  /** Data rows */\n  data: T[]\n  /** Column definitions */\n  columns: ColumnDef<T>[]\n  /** Search callback */\n  onSearch?: (query: string) => void\n  /** Create callback */\n  onCreate?: () => void\n  /** Read/View callback */\n  onRead?: (row: T) => void\n  /** Update callback */\n  onUpdate?: (row: T) => Promise<void>\n  /** Delete callback */\n  onDelete?: (ids: string[]) => Promise<void>\n  /** Audit log callback */\n  onViewAudit?: (row: T) => void\n  /** AI predicted actions */\n  predictedActions?: PredictedAction[]\n  /** Row selection enabled */\n  selectable?: boolean\n  /** Inline edit enabled */\n  inlineEdit?: boolean\n  /** Pagination */\n  pageSize?: number\n  /** Total count (for server-side pagination) */\n  totalCount?: number\n  /** Page change callback */\n  onPageChange?: (page: number) => void\n  /** Current page */\n  currentPage?: number\n  /** Loading state */\n  isLoading?: boolean\n  /** Title */\n  title?: string\n  /** Description */\n  description?: string\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Pagination Component\n// ============================================================================\n\nfunction TablePagination({\n  currentPage,\n  totalPages,\n  onPageChange,\n  pageSize,\n  totalCount,\n}: {\n  currentPage: number\n  totalPages: number\n  onPageChange: (page: number) => void\n  pageSize: number\n  totalCount: number\n}) {\n  const start = (currentPage - 1) * pageSize + 1\n  const end = Math.min(currentPage * pageSize, totalCount)\n\n  return (\n    <div className=\"flex items-center justify-between px-2 py-4\">\n      <div className=\"text-sm text-muted-foreground\">\n        Showing {start}-{end} of {totalCount}\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(1)}\n          disabled={currentPage === 1}\n        >\n          <ChevronsLeft className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(currentPage - 1)}\n          disabled={currentPage === 1}\n        >\n          <ChevronLeft className=\"h-4 w-4\" />\n        </Button>\n        <span className=\"text-sm\">\n          Page {currentPage} of {totalPages}\n        </span>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(currentPage + 1)}\n          disabled={currentPage === totalPages}\n        >\n          <ChevronRight className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => onPageChange(totalPages)}\n          disabled={currentPage === totalPages}\n        >\n          <ChevronsRight className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Predicted Actions Bar\n// ============================================================================\n\nfunction PredictedActionsBar({ actions }: { actions: PredictedAction[] }) {\n  if (!actions || actions.length === 0) return null\n\n  return (\n    <div className=\"flex items-center gap-2 rounded-lg bg-primary/5 border border-primary/20 p-3 mb-4\">\n      <Sparkles className=\"h-4 w-4 text-primary shrink-0\" />\n      <span className=\"text-sm font-medium\">Suggested:</span>\n      <div className=\"flex items-center gap-2 flex-wrap\">\n        {actions.slice(0, 3).map((action) => (\n          <TooltipProvider key={action.id}>\n            <Tooltip>\n              <TooltipTrigger>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"h-7 text-xs\"\n                  onClick={action.action}\n                >\n                  <Zap className=\"mr-1 h-3 w-3 text-primary\" />\n                  {action.label}\n                  <Badge variant=\"secondary\" className=\"ml-2 text-xs\">\n                    {action.confidence}%\n                  </Badge>\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>{action.description}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        ))}\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Editable Cell\n// ============================================================================\n\nfunction EditableCell<T>({\n  value,\n  isEditing,\n  onChange,\n  onSave,\n  onCancel,\n}: {\n  value: string\n  isEditing: boolean\n  onChange: (value: string) => void\n  onSave: () => void\n  onCancel: () => void\n}) {\n  const inputRef = React.useRef<HTMLInputElement>(null)\n\n  React.useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus()\n      inputRef.current.select()\n    }\n  }, [isEditing])\n\n  if (!isEditing) {\n    return <span>{value}</span>\n  }\n\n  return (\n    <div className=\"flex items-center gap-1\">\n      <Input\n        ref={inputRef}\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        className=\"h-7 text-sm\"\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") onSave()\n          if (e.key === \"Escape\") onCancel()\n        }}\n      />\n      <Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\" onClick={onSave}>\n        <Check className=\"h-3 w-3 text-green-600\" />\n      </Button>\n      <Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\" onClick={onCancel}>\n        <X className=\"h-3 w-3 text-red-600\" />\n      </Button>\n    </div>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function CRUDSAPTable<T extends { id: string }>({\n  data,\n  columns,\n  onSearch,\n  onCreate,\n  onRead,\n  onUpdate,\n  onDelete,\n  onViewAudit,\n  predictedActions,\n  selectable = true,\n  inlineEdit = true,\n  pageSize = 10,\n  totalCount,\n  onPageChange,\n  currentPage = 1,\n  isLoading = false,\n  title,\n  description,\n  className,\n}: CRUDSAPTableProps<T>) {\n  const [searchQuery, setSearchQuery] = React.useState(\"\")\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(new Set())\n  const [editingCell, setEditingCell] = React.useState<{ rowId: string; columnId: string } | null>(null)\n  const [editValue, setEditValue] = React.useState(\"\")\n  const [showDeleteDialog, setShowDeleteDialog] = React.useState(false)\n  const [isDeleting, setIsDeleting] = React.useState(false)\n  const [isSaving, setIsSaving] = React.useState(false)\n  const [sortColumn, setSortColumn] = React.useState<string | null>(null)\n  const [sortDirection, setSortDirection] = React.useState<\"asc\" | \"desc\">(\"asc\")\n\n  const effectiveTotalCount = totalCount ?? data.length\n  const totalPages = Math.ceil(effectiveTotalCount / pageSize)\n\n  // Handle search\n  const handleSearch = (query: string) => {\n    setSearchQuery(query)\n    onSearch?.(query)\n  }\n\n  // Handle selection\n  const toggleSelection = (id: string) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev)\n      if (next.has(id)) {\n        next.delete(id)\n      } else {\n        next.add(id)\n      }\n      return next\n    })\n  }\n\n  const toggleSelectAll = () => {\n    if (selectedIds.size === data.length) {\n      setSelectedIds(new Set())\n    } else {\n      setSelectedIds(new Set(data.map((row) => row.id)))\n    }\n  }\n\n  // Handle inline edit\n  const startEdit = (rowId: string, columnId: string, currentValue: string) => {\n    setEditingCell({ rowId, columnId })\n    setEditValue(currentValue)\n  }\n\n  const saveEdit = async () => {\n    if (!editingCell || !onUpdate) return\n\n    setIsSaving(true)\n    try {\n      const row = data.find((r) => r.id === editingCell.rowId)\n      if (row) {\n        const updatedRow = { ...row, [editingCell.columnId]: editValue }\n        await onUpdate(updatedRow as T)\n      }\n    } finally {\n      setIsSaving(false)\n      setEditingCell(null)\n    }\n  }\n\n  const cancelEdit = () => {\n    setEditingCell(null)\n    setEditValue(\"\")\n  }\n\n  // Handle delete\n  const handleDelete = async () => {\n    if (!onDelete || selectedIds.size === 0) return\n\n    setIsDeleting(true)\n    try {\n      await onDelete(Array.from(selectedIds))\n      setSelectedIds(new Set())\n    } finally {\n      setIsDeleting(false)\n      setShowDeleteDialog(false)\n    }\n  }\n\n  // Handle sort\n  const handleSort = (columnId: string) => {\n    if (sortColumn === columnId) {\n      setSortDirection((prev) => (prev === \"asc\" ? \"desc\" : \"asc\"))\n    } else {\n      setSortColumn(columnId)\n      setSortDirection(\"asc\")\n    }\n  }\n\n  // Get cell value\n  const getCellValue = (row: T, column: ColumnDef<T>): string => {\n    if (typeof column.accessorKey === \"function\") {\n      return String(column.accessorKey(row) ?? \"\")\n    }\n    return String(row[column.accessorKey] ?? \"\")\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            {title && <CardTitle>{title}</CardTitle>}\n            {description && <CardDescription>{description}</CardDescription>}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {onCreate && (\n              <Button onClick={onCreate}>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Create\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"mt-4 flex items-center gap-2\">\n          <div className=\"relative flex-1 max-w-sm\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search...\"\n              value={searchQuery}\n              onChange={(e) => handleSearch(e.target.value)}\n              className=\"pl-9\"\n            />\n          </div>\n          {selectable && selectedIds.size > 0 && (\n            <div className=\"flex items-center gap-2\">\n              <Badge variant=\"secondary\">{selectedIds.size} selected</Badge>\n              {onDelete && (\n                <Button\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  onClick={() => setShowDeleteDialog(true)}\n                >\n                  <Trash2 className=\"mr-1 h-3 w-3\" />\n                  Delete\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        {/* Predicted Actions */}\n        <PredictedActionsBar actions={predictedActions || []} />\n\n        {/* Table */}\n        <div className=\"rounded-lg border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                {selectable && (\n                  <TableHead className=\"w-10\">\n                    <Checkbox\n                      checked={selectedIds.size === data.length && data.length > 0}\n                      onCheckedChange={toggleSelectAll}\n                    />\n                  </TableHead>\n                )}\n                {columns.map((column) => (\n                  <TableHead\n                    key={column.id}\n                    style={{ width: column.width }}\n                    className={cn(column.sortable && \"cursor-pointer hover:bg-muted/50\")}\n                    onClick={() => column.sortable && handleSort(column.id)}\n                  >\n                    <div className=\"flex items-center gap-1\">\n                      {column.header}\n                      {column.sortable && (\n                        <ArrowUpDown className=\"h-3 w-3 text-muted-foreground\" />\n                      )}\n                    </div>\n                  </TableHead>\n                ))}\n                <TableHead className=\"w-20\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {isLoading ? (\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length + (selectable ? 2 : 1)}\n                    className=\"h-24 text-center\"\n                  >\n                    <Loader2 className=\"mx-auto h-6 w-6 animate-spin text-muted-foreground\" />\n                  </TableCell>\n                </TableRow>\n              ) : data.length === 0 ? (\n                <TableRow>\n                  <TableCell\n                    colSpan={columns.length + (selectable ? 2 : 1)}\n                    className=\"h-24 text-center text-muted-foreground\"\n                  >\n                    No data found\n                  </TableCell>\n                </TableRow>\n              ) : (\n                data.map((row) => (\n                  <TableRow\n                    key={row.id}\n                    className={cn(selectedIds.has(row.id) && \"bg-muted/50\")}\n                  >\n                    {selectable && (\n                      <TableCell>\n                        <Checkbox\n                          checked={selectedIds.has(row.id)}\n                          onCheckedChange={() => toggleSelection(row.id)}\n                        />\n                      </TableCell>\n                    )}\n                    {columns.map((column) => {\n                      const value = getCellValue(row, column)\n                      const isEditing =\n                        editingCell?.rowId === row.id &&\n                        editingCell?.columnId === column.id\n\n                      return (\n                        <TableCell\n                          key={column.id}\n                          onDoubleClick={() => {\n                            if (inlineEdit && column.editable) {\n                              startEdit(row.id, column.id, value)\n                            }\n                          }}\n                          className={cn(\n                            inlineEdit && column.editable && \"cursor-pointer hover:bg-muted/30\"\n                          )}\n                        >\n                          {column.cell ? (\n                            column.cell(row)\n                          ) : inlineEdit && column.editable ? (\n                            <EditableCell\n                              value={isEditing ? editValue : value}\n                              isEditing={isEditing}\n                              onChange={setEditValue}\n                              onSave={saveEdit}\n                              onCancel={cancelEdit}\n                            />\n                          ) : (\n                            value\n                          )}\n                        </TableCell>\n                      )\n                    })}\n                    <TableCell>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger>\n                          <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                            <MoreVertical className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          {onRead && (\n                            <DropdownMenuItem onClick={() => onRead(row)}>\n                              <Eye className=\"mr-2 h-4 w-4\" />\n                              View\n                            </DropdownMenuItem>\n                          )}\n                          {onUpdate && (\n                            <DropdownMenuItem onClick={() => onRead?.(row)}>\n                              <Edit className=\"mr-2 h-4 w-4\" />\n                              Edit\n                            </DropdownMenuItem>\n                          )}\n                          {onViewAudit && (\n                            <DropdownMenuItem onClick={() => onViewAudit(row)}>\n                              <History className=\"mr-2 h-4 w-4\" />\n                              Audit Log\n                            </DropdownMenuItem>\n                          )}\n                          <DropdownMenuSeparator />\n                          {onDelete && (\n                            <DropdownMenuItem\n                              className=\"text-destructive\"\n                              onClick={() => {\n                                setSelectedIds(new Set([row.id]))\n                                setShowDeleteDialog(true)\n                              }}\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Delete\n                            </DropdownMenuItem>\n                          )}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </div>\n\n        {/* Pagination */}\n        {totalPages > 1 && onPageChange && (\n          <TablePagination\n            currentPage={currentPage}\n            totalPages={totalPages}\n            onPageChange={onPageChange}\n            pageSize={pageSize}\n            totalCount={effectiveTotalCount}\n          />\n        )}\n      </CardContent>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete {selectedIds.size} item(s)?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. The selected items will be permanently deleted.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              disabled={isDeleting}\n            >\n              {isDeleting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Deleting...\n                </>\n              ) : (\n                <>\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </>\n              )}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { ColumnDef, PredictedAction }\n"
    }
  ]
}