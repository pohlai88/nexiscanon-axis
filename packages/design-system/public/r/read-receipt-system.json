{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "read-receipt-system",
  "type": "registry:block",
  "title": "Read Receipt System (AFANDA)",
  "description": "Document view tracking with acknowledgment requirements, reminders, and accountability reporting",
  "categories": [
    "afanda",
    "collaboration",
    "tracking"
  ],
  "registryDependencies": [
    "card",
    "table",
    "badge",
    "tooltip"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/afanda/read-receipt-system.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Read Receipt System - AFANDA Platform Component\n *\n * \"No excuse\" accountability tracking for document views.\n * Implements A01-CANONICAL.md §8 — AFANDA (Accountability)\n *\n * Features:\n * - Track who has viewed a document\n * - First view timestamp\n * - Time spent viewing\n * - Acknowledgment requirement\n * - Reminder sending\n *\n * @example\n * ```tsx\n * import { ReadReceiptSystem } from \"@workspace/design-system\"\n *\n * <ReadReceiptSystem\n *   document={documentData}\n *   recipients={recipientList}\n *   onSendReminder={(recipientId) => sendReminder(recipientId)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport { Progress } from \"@/components/progress\"\nimport { Avatar } from \"@/components/avatar\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/table\"\nimport {\n  Eye,\n  EyeOff,\n  CheckCircle,\n  Clock,\n  Send,\n  AlertCircle,\n  FileText,\n  Users,\n  Loader2,\n  Bell,\n  RefreshCw,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type ViewStatus = \"not_viewed\" | \"viewed\" | \"acknowledged\"\n\nexport interface Recipient {\n  id: string\n  name: string\n  email: string\n  role?: string\n  avatarUrl?: string\n  status: ViewStatus\n  firstViewedAt?: string | Date\n  lastViewedAt?: string | Date\n  viewCount?: number\n  totalViewTime?: number // in seconds\n  acknowledgedAt?: string | Date\n  reminderSentAt?: string | Date\n}\n\nexport interface DocumentInfo {\n  id: string\n  title: string\n  type?: string\n  sharedAt: string | Date\n  sharedBy: {\n    id: string\n    name: string\n  }\n  requiresAcknowledgment: boolean\n  deadline?: string | Date\n}\n\nexport interface ReadReceiptSystemProps {\n  /** Document information */\n  document: DocumentInfo\n  /** Recipients list */\n  recipients: Recipient[]\n  /** Send reminder callback */\n  onSendReminder?: (recipientId: string) => Promise<void>\n  /** Send all reminders callback */\n  onSendAllReminders?: () => Promise<void>\n  /** Refresh callback */\n  onRefresh?: () => Promise<void>\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction formatDuration(seconds: number): string {\n  if (seconds < 60) return `${seconds}s`\n  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${seconds % 60}s`\n  const hours = Math.floor(seconds / 3600)\n  const mins = Math.floor((seconds % 3600) / 60)\n  return `${hours}h ${mins}m`\n}\n\nfunction formatTimeAgo(date: string | Date): string {\n  const d = typeof date === \"string\" ? new Date(date) : date\n  const now = new Date()\n  const diffMs = now.getTime() - d.getTime()\n  const diffMins = Math.floor(diffMs / (1000 * 60))\n  const diffHours = Math.floor(diffMins / 60)\n  const diffDays = Math.floor(diffHours / 24)\n\n  if (diffMins < 1) return \"Just now\"\n  if (diffMins < 60) return `${diffMins}m ago`\n  if (diffHours < 24) return `${diffHours}h ago`\n  if (diffDays < 7) return `${diffDays}d ago`\n  return d.toLocaleDateString()\n}\n\n// ============================================================================\n// Status Badge\n// ============================================================================\n\nfunction StatusBadge({ status, acknowledgedAt }: { status: ViewStatus; acknowledgedAt?: string | Date }) {\n  const config = {\n    not_viewed: { icon: EyeOff, color: \"bg-gray-100 text-gray-700\", label: \"Not Viewed\" },\n    viewed: { icon: Eye, color: \"bg-blue-100 text-blue-700\", label: \"Viewed\" },\n    acknowledged: { icon: CheckCircle, color: \"bg-green-100 text-green-700\", label: \"Acknowledged\" },\n  }\n\n  const c = config[status]\n  const Icon = c.icon\n\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger>\n          <Badge className={cn(\"gap-1\", c.color)}>\n            <Icon className=\"h-3 w-3\" />\n            {c.label}\n          </Badge>\n        </TooltipTrigger>\n        {acknowledgedAt && (\n          <TooltipContent>\n            <p>Acknowledged: {new Date(acknowledgedAt).toLocaleString()}</p>\n          </TooltipContent>\n        )}\n      </Tooltip>\n    </TooltipProvider>\n  )\n}\n\n// ============================================================================\n// Summary Stats\n// ============================================================================\n\nfunction SummaryStats({\n  recipients,\n  requiresAcknowledgment,\n}: {\n  recipients: Recipient[]\n  requiresAcknowledgment: boolean\n}) {\n  const total = recipients.length\n  const viewed = recipients.filter((r) => r.status !== \"not_viewed\").length\n  const acknowledged = recipients.filter((r) => r.status === \"acknowledged\").length\n  const notViewed = recipients.filter((r) => r.status === \"not_viewed\").length\n\n  const viewedPercent = total > 0 ? (viewed / total) * 100 : 0\n  const ackPercent = total > 0 ? (acknowledged / total) * 100 : 0\n\n  return (\n    <div className=\"grid gap-4 md:grid-cols-4\">\n      <div className=\"rounded-lg border p-3 text-center\">\n        <p className=\"text-2xl font-bold\">{total}</p>\n        <p className=\"text-xs text-muted-foreground\">Total Recipients</p>\n      </div>\n      <div className=\"rounded-lg border p-3 text-center\">\n        <p className=\"text-2xl font-bold text-blue-600\">{viewed}</p>\n        <p className=\"text-xs text-muted-foreground\">Viewed ({viewedPercent.toFixed(0)}%)</p>\n      </div>\n      {requiresAcknowledgment && (\n        <div className=\"rounded-lg border p-3 text-center\">\n          <p className=\"text-2xl font-bold text-green-600\">{acknowledged}</p>\n          <p className=\"text-xs text-muted-foreground\">Acknowledged ({ackPercent.toFixed(0)}%)</p>\n        </div>\n      )}\n      <div className=\"rounded-lg border p-3 text-center\">\n        <p className=\"text-2xl font-bold text-amber-600\">{notViewed}</p>\n        <p className=\"text-xs text-muted-foreground\">Pending</p>\n      </div>\n    </div>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function ReadReceiptSystem({\n  document,\n  recipients,\n  onSendReminder,\n  onSendAllReminders,\n  onRefresh,\n  className,\n}: ReadReceiptSystemProps) {\n  const [sendingTo, setSendingTo] = React.useState<string | null>(null)\n  const [sendingAll, setSendingAll] = React.useState(false)\n  const [isRefreshing, setIsRefreshing] = React.useState(false)\n\n  const notViewed = recipients.filter((r) => r.status === \"not_viewed\")\n  const isOverdue = document.deadline && new Date(document.deadline) < new Date()\n\n  const handleSendReminder = async (recipientId: string) => {\n    if (!onSendReminder) return\n    setSendingTo(recipientId)\n    try {\n      await onSendReminder(recipientId)\n    } finally {\n      setSendingTo(null)\n    }\n  }\n\n  const handleSendAll = async () => {\n    if (!onSendAllReminders) return\n    setSendingAll(true)\n    try {\n      await onSendAllReminders()\n    } finally {\n      setSendingAll(false)\n    }\n  }\n\n  const handleRefresh = async () => {\n    if (!onRefresh) return\n    setIsRefreshing(true)\n    try {\n      await onRefresh()\n    } finally {\n      setIsRefreshing(false)\n    }\n  }\n\n  // Progress bar\n  const viewedCount = recipients.filter((r) => r.status !== \"not_viewed\").length\n  const progress = recipients.length > 0 ? (viewedCount / recipients.length) * 100 : 100\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Eye className=\"h-5 w-5\" />\n              Read Receipts\n            </CardTitle>\n            <CardDescription className=\"flex items-center gap-2 mt-1\">\n              <FileText className=\"h-4 w-4\" />\n              {document.title}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {onRefresh && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleRefresh}\n                disabled={isRefreshing}\n              >\n                <RefreshCw className={cn(\"h-4 w-4\", isRefreshing && \"animate-spin\")} />\n              </Button>\n            )}\n            {onSendAllReminders && notViewed.length > 0 && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSendAll}\n                disabled={sendingAll}\n              >\n                {sendingAll ? (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                ) : (\n                  <Bell className=\"mr-2 h-4 w-4\" />\n                )}\n                Remind All ({notViewed.length})\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Document Info */}\n        <div className=\"mt-4 flex items-center gap-4 text-sm text-muted-foreground\">\n          <span>Shared by {document.sharedBy.name}</span>\n          <span>•</span>\n          <span>{formatTimeAgo(document.sharedAt)}</span>\n          {document.deadline && (\n            <>\n              <span>•</span>\n              <span className={cn(isOverdue && \"text-red-600 font-medium\")}>\n                {isOverdue ? \"Overdue\" : `Due: ${new Date(document.deadline).toLocaleDateString()}`}\n              </span>\n            </>\n          )}\n        </div>\n\n        {/* Progress */}\n        <div className=\"mt-4 space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span className=\"text-muted-foreground\">View Progress</span>\n            <span className=\"font-medium\">{progress.toFixed(0)}%</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* Summary */}\n        <SummaryStats\n          recipients={recipients}\n          requiresAcknowledgment={document.requiresAcknowledgment}\n        />\n\n        {/* Overdue Warning */}\n        {isOverdue && notViewed.length > 0 && (\n          <div className=\"flex items-start gap-2 rounded-lg border border-red-200 bg-red-50 dark:bg-red-950 p-3\">\n            <AlertCircle className=\"h-5 w-5 text-red-600 shrink-0\" />\n            <div>\n              <p className=\"font-medium text-red-700 dark:text-red-300\">\n                Deadline Passed - {notViewed.length} recipient(s) haven't viewed\n              </p>\n              <p className=\"text-sm text-red-600 dark:text-red-400\">\n                Consider sending reminders or escalating.\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Recipients Table */}\n        <div className=\"rounded-lg border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Recipient</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>First Viewed</TableHead>\n                <TableHead>View Time</TableHead>\n                <TableHead className=\"w-24\">Action</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {recipients.map((recipient) => (\n                <TableRow\n                  key={recipient.id}\n                  className={cn(\n                    recipient.status === \"not_viewed\" && \"bg-amber-50/50 dark:bg-amber-950/20\"\n                  )}\n                >\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <Avatar className=\"h-8 w-8\">\n                        {recipient.avatarUrl ? (\n                          <img src={recipient.avatarUrl} alt={recipient.name} />\n                        ) : (\n                          <div className=\"flex h-full w-full items-center justify-center bg-muted text-sm font-medium\">\n                            {recipient.name.charAt(0).toUpperCase()}\n                          </div>\n                        )}\n                      </Avatar>\n                      <div>\n                        <p className=\"font-medium\">{recipient.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">{recipient.email}</p>\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <StatusBadge\n                      status={recipient.status}\n                      acknowledgedAt={recipient.acknowledgedAt}\n                    />\n                  </TableCell>\n                  <TableCell>\n                    {recipient.firstViewedAt ? (\n                      <div>\n                        <p className=\"text-sm\">{formatTimeAgo(recipient.firstViewedAt)}</p>\n                        {recipient.viewCount && recipient.viewCount > 1 && (\n                          <p className=\"text-xs text-muted-foreground\">\n                            {recipient.viewCount} views\n                          </p>\n                        )}\n                      </div>\n                    ) : (\n                      <span className=\"text-muted-foreground\">—</span>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    {recipient.totalViewTime ? (\n                      <span className=\"text-sm\">{formatDuration(recipient.totalViewTime)}</span>\n                    ) : (\n                      <span className=\"text-muted-foreground\">—</span>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    {recipient.status === \"not_viewed\" && onSendReminder && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSendReminder(recipient.id)}\n                        disabled={sendingTo === recipient.id}\n                      >\n                        {sendingTo === recipient.id ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        ) : (\n                          <Send className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                    )}\n                    {recipient.reminderSentAt && (\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              Reminded\n                            </Badge>\n                          </TooltipTrigger>\n                          <TooltipContent>\n                            <p>\n                              Reminder sent: {new Date(recipient.reminderSentAt).toLocaleString()}\n                            </p>\n                          </TooltipContent>\n                        </Tooltip>\n                      </TooltipProvider>\n                    )}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n\n        {/* No Excuse Notice */}\n        <div className=\"flex items-center gap-2 text-xs text-muted-foreground border-t pt-3\">\n          <Eye className=\"h-3 w-3\" />\n          <span>\"No excuse\" policy: All views are tracked and timestamped for accountability.</span>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { ViewStatus, Recipient, DocumentInfo }\n"
    }
  ]
}