{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "six-w1h-manifest",
  "type": "registry:block",
  "title": "6W1H Manifest (Quorum)",
  "description": "Displays immutable 6W1H contextual information (Who, What, When, Where, Why, Which, How) per Nexus Doctrine",
  "categories": [
    "quorum",
    "analysis",
    "audit"
  ],
  "registryDependencies": [
    "card",
    "badge",
    "collapsible"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/quorum/six-w1h-manifest.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * 6W1H Manifest Display - Quorum Kernel Audit Context\n *\n * Displays full contextual information for any action or decision.\n * Implements A01-CANONICAL.md §5 — Nexus Doctrine (100-Year Recall Promise)\n *\n * 6W1H Context:\n * - WHO: Actor + delegation chain + approval chain\n * - WHAT: Action type + affected entities\n * - WHEN: Timestamp + effective date + fiscal period\n * - WHERE: Tenant + location + system context\n * - WHY: Reason code + justification + business context\n * - WHICH: Options presented + selected option + policy overrides\n * - HOW: Execution path + method + evidence\n *\n * @example\n * ```tsx\n * import { SixW1HManifest } from \"@workspace/design-system\"\n *\n * <SixW1HManifest\n *   data={eventData}\n *   variant=\"card\"\n *   showDangerZone={true}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Separator } from \"@/components/separator\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/tooltip\"\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/collapsible\"\nimport {\n  User,\n  FileText,\n  Calendar,\n  MapPin,\n  HelpCircle,\n  List,\n  Settings,\n  AlertTriangle,\n  ChevronDown,\n  ChevronRight,\n  ExternalLink,\n  Shield,\n  Clock,\n  Building,\n  Paperclip,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types (A01-CANONICAL.md §5 compliant)\n// ============================================================================\n\nexport interface Actor {\n  id: string\n  name: string\n  role?: string\n  email?: string\n  avatarUrl?: string\n}\n\nexport interface EntityRef {\n  id: string\n  type: string\n  label: string\n  href?: string\n}\n\nexport interface PolicyRef {\n  id: string\n  name: string\n  description?: string\n  severity?: \"info\" | \"warning\" | \"error\"\n}\n\nexport interface EvidenceRef {\n  id: string\n  type: \"file\" | \"link\" | \"email\" | \"document\"\n  label: string\n  href?: string\n  uploadedAt?: string\n}\n\nexport interface SixW1HData {\n  /** Event/Action ID */\n  eventId: string\n\n  /** WHO performed this action */\n  who: {\n    actor: Actor\n    onBehalfOf?: Actor\n    approvalChain?: Actor[]\n  }\n\n  /** WHAT action was taken */\n  what: {\n    action: string\n    actionType: string\n    sourceDocument?: EntityRef\n    affectedEntities?: EntityRef[]\n  }\n\n  /** WHEN it occurred */\n  when: {\n    timestamp: string | Date\n    effectiveDate?: string | Date\n    period?: string\n    timezone?: string\n  }\n\n  /** WHERE in the system/organization */\n  where: {\n    tenant: string\n    location?: string\n    branch?: string\n    systemContext?: string\n  }\n\n  /** WHY was this decision made */\n  why?: {\n    reasonCode?: string\n    justification?: string\n    businessContext?: string\n  }\n\n  /** WHICH options were available */\n  which?: {\n    optionsPresented?: string[]\n    selectedOption?: string\n    policyOverrides?: PolicyRef[]\n  }\n\n  /** HOW it was executed */\n  how?: {\n    executionPath?: string\n    method?: \"ui\" | \"api\" | \"import\" | \"automation\" | \"system\"\n    evidence?: EvidenceRef[]\n  }\n\n  /** Danger Zone metadata (if policies were overridden) */\n  dangerZone?: {\n    violatedPolicies: PolicyRef[]\n    riskScore: number\n    warningsAcknowledged?: string[]\n    overrideApprovedBy?: Actor\n  }\n}\n\nexport interface SixW1HManifestProps {\n  /** 6W1H event data */\n  data: SixW1HData\n  /** Display variant */\n  variant?: \"card\" | \"panel\" | \"inline\" | \"compact\"\n  /** Show danger zone section */\n  showDangerZone?: boolean\n  /** Initially collapsed sections */\n  collapsedSections?: (\"who\" | \"what\" | \"when\" | \"where\" | \"why\" | \"which\" | \"how\")[]\n  /** Callback when entity is clicked */\n  onEntityClick?: (entity: EntityRef) => void\n  /** Callback when actor is clicked */\n  onActorClick?: (actor: Actor) => void\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Helper Components\n// ============================================================================\n\nfunction SectionHeader({\n  icon: Icon,\n  label,\n  isOpen,\n  onClick,\n  badge,\n}: {\n  icon: React.ComponentType<{ className?: string }>\n  label: string\n  isOpen: boolean\n  onClick: () => void\n  badge?: React.ReactNode\n}) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"flex w-full items-center gap-2 py-2 text-sm font-semibold text-foreground\",\n        \"hover:text-primary transition-colors\"\n      )}\n    >\n      {isOpen ? (\n        <ChevronDown className=\"h-4 w-4\" />\n      ) : (\n        <ChevronRight className=\"h-4 w-4\" />\n      )}\n      <Icon className=\"h-4 w-4 text-muted-foreground\" />\n      <span>{label}</span>\n      {badge}\n    </button>\n  )\n}\n\nfunction ActorDisplay({\n  actor,\n  role,\n  onClick,\n}: {\n  actor: Actor\n  role?: string\n  onClick?: (actor: Actor) => void\n}) {\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-2\",\n        onClick && \"cursor-pointer hover:text-primary\"\n      )}\n      onClick={() => onClick?.(actor)}\n    >\n      <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-xs font-medium\">\n        {actor.avatarUrl ? (\n          <img\n            src={actor.avatarUrl}\n            alt={actor.name}\n            className=\"h-8 w-8 rounded-full\"\n          />\n        ) : (\n          actor.name.charAt(0).toUpperCase()\n        )}\n      </div>\n      <div className=\"flex flex-col\">\n        <span className=\"text-sm font-medium\">{actor.name}</span>\n        {(role || actor.role) && (\n          <span className=\"text-xs text-muted-foreground\">\n            {role || actor.role}\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction EntityLink({\n  entity,\n  onClick,\n}: {\n  entity: EntityRef\n  onClick?: (entity: EntityRef) => void\n}) {\n  return (\n    <button\n      onClick={() => onClick?.(entity)}\n      className={cn(\n        \"inline-flex items-center gap-1 rounded px-2 py-0.5 text-sm\",\n        \"bg-muted hover:bg-accent transition-colors\"\n      )}\n    >\n      <span className=\"text-muted-foreground\">{entity.type}:</span>\n      <span className=\"font-medium\">{entity.label}</span>\n      {entity.href && <ExternalLink className=\"h-3 w-3\" />}\n    </button>\n  )\n}\n\nfunction formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {\n  const d = typeof date === \"string\" ? new Date(date) : date\n  return d.toLocaleDateString(\"en-US\", {\n    year: \"numeric\",\n    month: \"short\",\n    day: \"numeric\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    ...options,\n  })\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function SixW1HManifest({\n  data,\n  variant = \"card\",\n  showDangerZone = true,\n  collapsedSections = [],\n  onEntityClick,\n  onActorClick,\n  className,\n}: SixW1HManifestProps) {\n  const [openSections, setOpenSections] = React.useState<Record<string, boolean>>(\n    () => {\n      const sections = [\"who\", \"what\", \"when\", \"where\", \"why\", \"which\", \"how\"]\n      return sections.reduce(\n        (acc, section) => ({\n          ...acc,\n          [section]: !collapsedSections.includes(section as typeof collapsedSections[number]),\n        }),\n        {}\n      )\n    }\n  )\n\n  const toggleSection = (section: string) => {\n    setOpenSections((prev) => ({ ...prev, [section]: !prev[section] }))\n  }\n\n  const hasDangerZone = showDangerZone && data.dangerZone && data.dangerZone.violatedPolicies.length > 0\n\n  const content = (\n    <div className=\"space-y-4\">\n      {/* Danger Zone Alert */}\n      {hasDangerZone && (\n        <div className=\"rounded-lg border border-destructive/50 bg-destructive/10 p-4\">\n          <div className=\"flex items-start gap-3\">\n            <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n            <div className=\"flex-1\">\n              <h4 className=\"font-semibold text-destructive\">Danger Zone</h4>\n              <p className=\"mt-1 text-sm text-muted-foreground\">\n                This action violated {data.dangerZone!.violatedPolicies.length} policy(s)\n              </p>\n              <div className=\"mt-2 flex items-center gap-2\">\n                <Badge variant=\"destructive\">\n                  Risk Score: {data.dangerZone!.riskScore}/100\n                </Badge>\n                {data.dangerZone!.overrideApprovedBy && (\n                  <span className=\"text-xs text-muted-foreground\">\n                    Override by: {data.dangerZone!.overrideApprovedBy.name}\n                  </span>\n                )}\n              </div>\n              <div className=\"mt-3 space-y-1\">\n                {data.dangerZone!.violatedPolicies.map((policy) => (\n                  <div\n                    key={policy.id}\n                    className=\"flex items-center gap-2 text-sm\"\n                  >\n                    <Shield className=\"h-3 w-3 text-destructive\" />\n                    <span>{policy.name}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* WHO Section */}\n      <Collapsible open={openSections.who} onOpenChange={() => toggleSection(\"who\")}>\n        <CollapsibleTrigger>\n          <SectionHeader\n            icon={User}\n            label=\"WHO\"\n            isOpen={openSections.who ?? true}\n            onClick={() => toggleSection(\"who\")}\n          />\n        </CollapsibleTrigger>\n        <CollapsibleContent className=\"pl-6 pt-2 space-y-3\">\n          <div>\n            <span className=\"text-xs text-muted-foreground\">Actor:</span>\n            <ActorDisplay actor={data.who.actor} onClick={onActorClick} />\n          </div>\n          {data.who.onBehalfOf && (\n            <div>\n              <span className=\"text-xs text-muted-foreground\">On behalf of:</span>\n              <ActorDisplay actor={data.who.onBehalfOf} onClick={onActorClick} />\n            </div>\n          )}\n          {data.who.approvalChain && data.who.approvalChain.length > 0 && (\n            <div>\n              <span className=\"text-xs text-muted-foreground\">Approval Chain:</span>\n              <div className=\"mt-1 flex flex-wrap gap-2\">\n                {data.who.approvalChain.map((actor, index) => (\n                  <React.Fragment key={actor.id}>\n                    <ActorDisplay actor={actor} onClick={onActorClick} />\n                    {index < data.who.approvalChain!.length - 1 && (\n                      <span className=\"text-muted-foreground\">→</span>\n                    )}\n                  </React.Fragment>\n                ))}\n              </div>\n            </div>\n          )}\n        </CollapsibleContent>\n      </Collapsible>\n\n      <Separator />\n\n      {/* WHAT Section */}\n      <Collapsible open={openSections.what} onOpenChange={() => toggleSection(\"what\")}>\n        <CollapsibleTrigger>\n          <SectionHeader\n            icon={FileText}\n            label=\"WHAT\"\n            isOpen={openSections.what ?? true}\n            onClick={() => toggleSection(\"what\")}\n          />\n        </CollapsibleTrigger>\n        <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\">{data.what.actionType}</Badge>\n            <span className=\"font-medium\">{data.what.action}</span>\n          </div>\n          {data.what.sourceDocument && (\n            <div>\n              <span className=\"text-xs text-muted-foreground\">Source Document:</span>\n              <div className=\"mt-1\">\n                <EntityLink entity={data.what.sourceDocument} onClick={onEntityClick} />\n              </div>\n            </div>\n          )}\n          {data.what.affectedEntities && data.what.affectedEntities.length > 0 && (\n            <div>\n              <span className=\"text-xs text-muted-foreground\">Affected Entities:</span>\n              <div className=\"mt-1 flex flex-wrap gap-2\">\n                {data.what.affectedEntities.map((entity) => (\n                  <EntityLink key={entity.id} entity={entity} onClick={onEntityClick} />\n                ))}\n              </div>\n            </div>\n          )}\n        </CollapsibleContent>\n      </Collapsible>\n\n      <Separator />\n\n      {/* WHEN Section */}\n      <Collapsible open={openSections.when} onOpenChange={() => toggleSection(\"when\")}>\n        <CollapsibleTrigger>\n          <SectionHeader\n            icon={Calendar}\n            label=\"WHEN\"\n            isOpen={openSections.when ?? true}\n            onClick={() => toggleSection(\"when\")}\n          />\n        </CollapsibleTrigger>\n        <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n          <div className=\"grid gap-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-muted-foreground\">Timestamp:</span>\n              <span className=\"font-medium\">{formatDate(data.when.timestamp)}</span>\n            </div>\n            {data.when.effectiveDate && (\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Effective:</span>\n                <span className=\"font-medium\">\n                  {formatDate(data.when.effectiveDate, { hour: undefined, minute: undefined })}\n                </span>\n              </div>\n            )}\n            {data.when.period && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-muted-foreground\">Period:</span>\n                <Badge variant=\"secondary\">{data.when.period}</Badge>\n              </div>\n            )}\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n\n      <Separator />\n\n      {/* WHERE Section */}\n      <Collapsible open={openSections.where} onOpenChange={() => toggleSection(\"where\")}>\n        <CollapsibleTrigger>\n          <SectionHeader\n            icon={MapPin}\n            label=\"WHERE\"\n            isOpen={openSections.where ?? true}\n            onClick={() => toggleSection(\"where\")}\n          />\n        </CollapsibleTrigger>\n        <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n          <div className=\"grid gap-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Building className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-muted-foreground\">Tenant:</span>\n              <span className=\"font-medium\">{data.where.tenant}</span>\n            </div>\n            {data.where.location && (\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Location:</span>\n                <span className=\"font-medium\">{data.where.location}</span>\n              </div>\n            )}\n            {data.where.branch && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-muted-foreground\">Branch:</span>\n                <span className=\"font-medium\">{data.where.branch}</span>\n              </div>\n            )}\n            {data.where.systemContext && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-muted-foreground\">System:</span>\n                <Badge variant=\"outline\">{data.where.systemContext}</Badge>\n              </div>\n            )}\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n\n      {/* WHY Section */}\n      {data.why && (\n        <>\n          <Separator />\n          <Collapsible open={openSections.why} onOpenChange={() => toggleSection(\"why\")}>\n            <CollapsibleTrigger>\n              <SectionHeader\n                icon={HelpCircle}\n                label=\"WHY\"\n                isOpen={openSections.why ?? true}\n                onClick={() => toggleSection(\"why\")}\n              />\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n              {data.why.reasonCode && (\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-muted-foreground text-sm\">Reason:</span>\n                  <Badge variant=\"secondary\">{data.why.reasonCode}</Badge>\n                </div>\n              )}\n              {data.why.justification && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Justification:</span>\n                  <p className=\"mt-1 text-sm bg-muted p-2 rounded\">\n                    \"{data.why.justification}\"\n                  </p>\n                </div>\n              )}\n              {data.why.businessContext && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Business Context:</span>\n                  <p className=\"mt-1 text-sm\">{data.why.businessContext}</p>\n                </div>\n              )}\n            </CollapsibleContent>\n          </Collapsible>\n        </>\n      )}\n\n      {/* WHICH Section */}\n      {data.which && (\n        <>\n          <Separator />\n          <Collapsible open={openSections.which} onOpenChange={() => toggleSection(\"which\")}>\n            <CollapsibleTrigger>\n              <SectionHeader\n                icon={List}\n                label=\"WHICH\"\n                isOpen={openSections.which ?? true}\n                onClick={() => toggleSection(\"which\")}\n              />\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n              {data.which.optionsPresented && data.which.optionsPresented.length > 0 && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Options Presented:</span>\n                  <div className=\"mt-1 flex flex-wrap gap-1\">\n                    {data.which.optionsPresented.map((option, index) => (\n                      <Badge\n                        key={index}\n                        variant={option === data.which?.selectedOption ? \"default\" : \"outline\"}\n                      >\n                        {option}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n              {data.which.policyOverrides && data.which.policyOverrides.length > 0 && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Policy Overrides:</span>\n                  <div className=\"mt-1 space-y-1\">\n                    {data.which.policyOverrides.map((policy) => (\n                      <div key={policy.id} className=\"flex items-center gap-2 text-sm\">\n                        <Shield className=\"h-3 w-3 text-amber-500\" />\n                        <span>{policy.name}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CollapsibleContent>\n          </Collapsible>\n        </>\n      )}\n\n      {/* HOW Section */}\n      {data.how && (\n        <>\n          <Separator />\n          <Collapsible open={openSections.how} onOpenChange={() => toggleSection(\"how\")}>\n            <CollapsibleTrigger>\n              <SectionHeader\n                icon={Settings}\n                label=\"HOW\"\n                isOpen={openSections.how ?? true}\n                onClick={() => toggleSection(\"how\")}\n              />\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pl-6 pt-2 space-y-2\">\n              {data.how.method && (\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-muted-foreground text-sm\">Method:</span>\n                  <Badge variant=\"outline\">{data.how.method.toUpperCase()}</Badge>\n                </div>\n              )}\n              {data.how.executionPath && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Execution Path:</span>\n                  <code className=\"mt-1 block text-xs bg-muted p-2 rounded font-mono\">\n                    {data.how.executionPath}\n                  </code>\n                </div>\n              )}\n              {data.how.evidence && data.how.evidence.length > 0 && (\n                <div>\n                  <span className=\"text-xs text-muted-foreground\">Evidence:</span>\n                  <div className=\"mt-1 space-y-1\">\n                    {data.how.evidence.map((evidence) => (\n                      <div\n                        key={evidence.id}\n                        className=\"flex items-center gap-2 text-sm\"\n                      >\n                        <Paperclip className=\"h-3 w-3 text-muted-foreground\" />\n                        <a\n                          href={evidence.href}\n                          className=\"text-primary hover:underline\"\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                        >\n                          {evidence.label}\n                        </a>\n                        {evidence.uploadedAt && (\n                          <span className=\"text-xs text-muted-foreground\">\n                            ({formatDate(evidence.uploadedAt)})\n                          </span>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CollapsibleContent>\n          </Collapsible>\n        </>\n      )}\n    </div>\n  )\n\n  // Render based on variant\n  if (variant === \"card\") {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            6W1H Context\n          </CardTitle>\n          <CardDescription>\n            Event ID: {data.eventId}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>{content}</CardContent>\n      </Card>\n    )\n  }\n\n  if (variant === \"panel\") {\n    return (\n      <div className={cn(\"rounded-lg border bg-card p-4\", className)}>\n        <h3 className=\"mb-4 font-semibold flex items-center gap-2\">\n          <FileText className=\"h-5 w-5\" />\n          6W1H Context — {data.eventId}\n        </h3>\n        {content}\n      </div>\n    )\n  }\n\n  if (variant === \"compact\") {\n    return (\n      <div className={cn(\"text-sm\", className)}>\n        <div className=\"flex flex-wrap gap-4\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger>\n                <div className=\"flex items-center gap-1 text-muted-foreground\">\n                  <User className=\"h-3 w-3\" />\n                  <span>{data.who.actor.name}</span>\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>WHO: {data.who.actor.name}</TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n          <div className=\"flex items-center gap-1 text-muted-foreground\">\n            <FileText className=\"h-3 w-3\" />\n            <span>{data.what.action}</span>\n          </div>\n          <div className=\"flex items-center gap-1 text-muted-foreground\">\n            <Clock className=\"h-3 w-3\" />\n            <span>{formatDate(data.when.timestamp)}</span>\n          </div>\n          {hasDangerZone && (\n            <Badge variant=\"destructive\" className=\"text-xs\">\n              ⚠️ Risk: {data.dangerZone!.riskScore}\n            </Badge>\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  // Default: inline\n  return <div className={className}>{content}</div>\n}\n\n// ============================================================================\n// Export Types\n// ============================================================================\n\nexport type {\n  Actor,\n  EntityRef,\n  PolicyRef,\n  EvidenceRef,\n  SixW1HData,\n}\n"
    }
  ]
}