{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "trial-balance-table",
  "type": "registry:block",
  "title": "Trial Balance Table (ERP)",
  "description": "GL trial balance with debit/credit columns, balance verification, period comparison, and drill-through",
  "categories": [
    "erp",
    "accounting",
    "general-ledger"
  ],
  "registryDependencies": [
    "table",
    "card",
    "select"
  ],
  "dependencies": [],
  "devDependencies": [],
  "files": [
    {
      "path": "src/blocks/erp/trial-balance-table.tsx",
      "type": "registry:component",
      "content": "\"use client\"\n\n/**\n * Trial Balance Table - ERP Domain Component\n *\n * General Ledger trial balance display.\n * Implements A01-CANONICAL.md §3 — Three Pillars (Money)\n *\n * Features:\n * - Debit/Credit columns\n * - Account hierarchy\n * - Balance verification\n * - Period comparison\n * - Drill-down to ledger\n *\n * @example\n * ```tsx\n * import { TrialBalanceTable } from \"@workspace/design-system\"\n *\n * <TrialBalanceTable\n *   accounts={trialBalanceData}\n *   period=\"January 2026\"\n *   onAccountClick={(account) => viewLedger(account.code)}\n * />\n * ```\n */\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/card\"\nimport { Badge } from \"@/components/badge\"\nimport { Button } from \"@/components/button\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/table\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/dropdown-menu\"\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/collapsible\"\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/select\"\nimport {\n  DollarSign,\n  Download,\n  ChevronDown,\n  ChevronRight,\n  ExternalLink,\n  CheckCircle,\n  AlertTriangle,\n  Calendar,\n  RefreshCw,\n  FileText,\n} from \"lucide-react\"\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type AccountType = \"asset\" | \"liability\" | \"equity\" | \"revenue\" | \"expense\"\n\nexport interface TrialBalanceAccount {\n  code: string\n  name: string\n  type: AccountType\n  debit: number\n  credit: number\n  balance: number\n  parentCode?: string\n  children?: TrialBalanceAccount[]\n  previousPeriodBalance?: number\n  budgetBalance?: number\n  variance?: number\n  variancePercentage?: number\n}\n\nexport interface TrialBalanceSummary {\n  totalDebits: number\n  totalCredits: number\n  difference: number\n  isBalanced: boolean\n  accountCount: number\n}\n\nexport interface TrialBalanceTableProps {\n  /** Account data (flat or hierarchical) */\n  accounts: TrialBalanceAccount[]\n  /** Period label */\n  period: string\n  /** Available periods for comparison */\n  periods?: string[]\n  /** Period change callback */\n  onPeriodChange?: (period: string) => void\n  /** Account click callback */\n  onAccountClick?: (account: TrialBalanceAccount) => void\n  /** Export callback */\n  onExport?: (format: \"csv\" | \"excel\" | \"pdf\") => void\n  /** Refresh callback */\n  onRefresh?: () => Promise<void>\n  /** Show hierarchy */\n  hierarchical?: boolean\n  /** Show comparison columns */\n  showComparison?: boolean\n  /** Currency symbol */\n  currency?: string\n  /** Custom className */\n  className?: string\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst ACCOUNT_TYPE_CONFIG: Record<AccountType, { label: string; color: string }> = {\n  asset: { label: \"Asset\", color: \"text-blue-600\" },\n  liability: { label: \"Liability\", color: \"text-purple-600\" },\n  equity: { label: \"Equity\", color: \"text-green-600\" },\n  revenue: { label: \"Revenue\", color: \"text-emerald-600\" },\n  expense: { label: \"Expense\", color: \"text-red-600\" },\n}\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction formatCurrency(amount: number, currency: string = \"$\"): string {\n  const absAmount = Math.abs(amount)\n  const formatted = `${currency}${absAmount.toLocaleString(\"en-US\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })}`\n  return amount < 0 ? `(${formatted})` : formatted\n}\n\nfunction calculateSummary(accounts: TrialBalanceAccount[]): TrialBalanceSummary {\n  const flatAccounts = flattenAccounts(accounts)\n  const totalDebits = flatAccounts.reduce((sum, acc) => sum + acc.debit, 0)\n  const totalCredits = flatAccounts.reduce((sum, acc) => sum + acc.credit, 0)\n  const difference = Math.abs(totalDebits - totalCredits)\n\n  return {\n    totalDebits,\n    totalCredits,\n    difference,\n    isBalanced: difference < 0.01, // Allow for rounding errors\n    accountCount: flatAccounts.length,\n  }\n}\n\nfunction flattenAccounts(accounts: TrialBalanceAccount[]): TrialBalanceAccount[] {\n  const result: TrialBalanceAccount[] = []\n\n  function flatten(accs: TrialBalanceAccount[]) {\n    for (const acc of accs) {\n      result.push(acc)\n      if (acc.children) {\n        flatten(acc.children)\n      }\n    }\n  }\n\n  flatten(accounts)\n  return result\n}\n\n// ============================================================================\n// Account Row Component\n// ============================================================================\n\nfunction AccountRow({\n  account,\n  level = 0,\n  onAccountClick,\n  showComparison,\n  currency,\n  hierarchical,\n}: {\n  account: TrialBalanceAccount\n  level?: number\n  onAccountClick?: (account: TrialBalanceAccount) => void\n  showComparison: boolean\n  currency: string\n  hierarchical: boolean\n}) {\n  const [isExpanded, setIsExpanded] = React.useState(true)\n  const hasChildren = account.children && account.children.length > 0\n  const typeConfig = ACCOUNT_TYPE_CONFIG[account.type]\n\n  return (\n    <>\n      <TableRow\n        className={cn(\n          level === 0 && \"bg-muted/30 font-medium\",\n          onAccountClick && \"cursor-pointer hover:bg-muted/50\"\n        )}\n        onClick={() => {\n          if (!hasChildren || !hierarchical) {\n            onAccountClick?.(account)\n          }\n        }}\n      >\n        <TableCell className=\"font-mono\">\n          <div\n            className=\"flex items-center gap-2\"\n            style={{ paddingLeft: `${level * 20}px` }}\n          >\n            {hierarchical && hasChildren && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-5 w-5 p-0\"\n                onClick={(e) => {\n                  e.stopPropagation()\n                  setIsExpanded(!isExpanded)\n                }}\n              >\n                {isExpanded ? (\n                  <ChevronDown className=\"h-3 w-3\" />\n                ) : (\n                  <ChevronRight className=\"h-3 w-3\" />\n                )}\n              </Button>\n            )}\n            {!hasChildren && hierarchical && <span className=\"w-5\" />}\n            <span>{account.code}</span>\n          </div>\n        </TableCell>\n        <TableCell>\n          <div className=\"flex items-center gap-2\">\n            <span className={cn(level === 0 && \"font-semibold\")}>{account.name}</span>\n            {onAccountClick && !hasChildren && (\n              <ExternalLink className=\"h-3 w-3 text-muted-foreground\" />\n            )}\n          </div>\n        </TableCell>\n        <TableCell className={cn(\"text-right\", typeConfig.color)}>\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {typeConfig.label}\n          </Badge>\n        </TableCell>\n        <TableCell className=\"text-right font-mono\">\n          {account.debit > 0 ? formatCurrency(account.debit, currency) : \"—\"}\n        </TableCell>\n        <TableCell className=\"text-right font-mono\">\n          {account.credit > 0 ? formatCurrency(account.credit, currency) : \"—\"}\n        </TableCell>\n        <TableCell\n          className={cn(\n            \"text-right font-mono font-medium\",\n            account.balance > 0 ? \"text-blue-600\" : account.balance < 0 ? \"text-red-600\" : \"\"\n          )}\n        >\n          {formatCurrency(account.balance, currency)}\n        </TableCell>\n        {showComparison && (\n          <>\n            <TableCell className=\"text-right font-mono text-muted-foreground\">\n              {account.previousPeriodBalance !== undefined\n                ? formatCurrency(account.previousPeriodBalance, currency)\n                : \"—\"}\n            </TableCell>\n            <TableCell\n              className={cn(\n                \"text-right font-mono\",\n                account.variance && account.variance > 0\n                  ? \"text-green-600\"\n                  : account.variance && account.variance < 0\n                  ? \"text-red-600\"\n                  : \"\"\n              )}\n            >\n              {account.variance !== undefined ? (\n                <>\n                  {account.variance > 0 ? \"+\" : \"\"}\n                  {formatCurrency(account.variance, currency)}\n                  {account.variancePercentage !== undefined && (\n                    <span className=\"text-xs ml-1\">\n                      ({account.variancePercentage > 0 ? \"+\" : \"\"}\n                      {account.variancePercentage.toFixed(1)}%)\n                    </span>\n                  )}\n                </>\n              ) : (\n                \"—\"\n              )}\n            </TableCell>\n          </>\n        )}\n      </TableRow>\n\n      {/* Children */}\n      {hierarchical && hasChildren && isExpanded && (\n        <>\n          {account.children!.map((child) => (\n            <AccountRow\n              key={child.code}\n              account={child}\n              level={level + 1}\n              onAccountClick={onAccountClick}\n              showComparison={showComparison}\n              currency={currency}\n              hierarchical={hierarchical}\n            />\n          ))}\n        </>\n      )}\n    </>\n  )\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function TrialBalanceTable({\n  accounts,\n  period,\n  periods = [],\n  onPeriodChange,\n  onAccountClick,\n  onExport,\n  onRefresh,\n  hierarchical = true,\n  showComparison = false,\n  currency = \"$\",\n  className,\n}: TrialBalanceTableProps) {\n  const [selectedPeriod, setSelectedPeriod] = React.useState(period)\n  const [isRefreshing, setIsRefreshing] = React.useState(false)\n\n  const summary = calculateSummary(accounts)\n\n  const handlePeriodChange = (newPeriod: string | null) => {\n    if (!newPeriod) return\n    setSelectedPeriod(newPeriod)\n    onPeriodChange?.(newPeriod)\n  }\n\n  const handleRefresh = async () => {\n    if (!onRefresh) return\n    setIsRefreshing(true)\n    try {\n      await onRefresh()\n    } finally {\n      setIsRefreshing(false)\n    }\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Trial Balance\n            </CardTitle>\n            <CardDescription>\n              {summary.accountCount} accounts • Period: {selectedPeriod}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {periods.length > 0 && onPeriodChange && (\n              <Select value={selectedPeriod} onValueChange={handlePeriodChange}>\n                <SelectTrigger className=\"w-[160px]\">\n                  <Calendar className=\"mr-2 h-4 w-4\" />\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {periods.map((p) => (\n                    <SelectItem key={p} value={p}>\n                      {p}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            )}\n            {onRefresh && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleRefresh}\n                disabled={isRefreshing}\n              >\n                <RefreshCw className={cn(\"h-4 w-4\", isRefreshing && \"animate-spin\")} />\n              </Button>\n            )}\n            {onExport && (\n              <DropdownMenu>\n                <DropdownMenuTrigger>\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Export\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent>\n                  <DropdownMenuItem onClick={() => onExport(\"csv\")}>\n                    Export as CSV\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => onExport(\"excel\")}>\n                    Export as Excel\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => onExport(\"pdf\")}>\n                    Export as PDF\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n          </div>\n        </div>\n\n        {/* Balance Status */}\n        <div\n          className={cn(\n            \"mt-4 flex items-center gap-2 rounded-lg p-3\",\n            summary.isBalanced\n              ? \"bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-300\"\n              : \"bg-red-50 text-red-700 dark:bg-red-950 dark:text-red-300\"\n          )}\n        >\n          {summary.isBalanced ? (\n            <>\n              <CheckCircle className=\"h-5 w-5\" />\n              <span className=\"font-medium\">Trial Balance is in balance</span>\n            </>\n          ) : (\n            <>\n              <AlertTriangle className=\"h-5 w-5\" />\n              <span className=\"font-medium\">\n                Out of balance by {formatCurrency(summary.difference, currency)}\n              </span>\n            </>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <div className=\"rounded-lg border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-[120px]\">Code</TableHead>\n                <TableHead>Account Name</TableHead>\n                <TableHead className=\"w-[100px]\">Type</TableHead>\n                <TableHead className=\"w-[140px] text-right\">Debit</TableHead>\n                <TableHead className=\"w-[140px] text-right\">Credit</TableHead>\n                <TableHead className=\"w-[140px] text-right\">Balance</TableHead>\n                {showComparison && (\n                  <>\n                    <TableHead className=\"w-[140px] text-right\">Prior Period</TableHead>\n                    <TableHead className=\"w-[160px] text-right\">Variance</TableHead>\n                  </>\n                )}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {accounts.map((account) => (\n                <AccountRow\n                  key={account.code}\n                  account={account}\n                  onAccountClick={onAccountClick}\n                  showComparison={showComparison}\n                  currency={currency}\n                  hierarchical={hierarchical}\n                />\n              ))}\n\n              {/* Totals Row */}\n              <TableRow className=\"bg-muted font-bold\">\n                <TableCell colSpan={3}>Total</TableCell>\n                <TableCell className=\"text-right font-mono\">\n                  {formatCurrency(summary.totalDebits, currency)}\n                </TableCell>\n                <TableCell className=\"text-right font-mono\">\n                  {formatCurrency(summary.totalCredits, currency)}\n                </TableCell>\n                <TableCell\n                  className={cn(\n                    \"text-right font-mono\",\n                    !summary.isBalanced && \"text-red-600\"\n                  )}\n                >\n                  {summary.isBalanced\n                    ? \"Balanced\"\n                    : `Diff: ${formatCurrency(summary.difference, currency)}`}\n                </TableCell>\n                {showComparison && (\n                  <>\n                    <TableCell />\n                    <TableCell />\n                  </>\n                )}\n              </TableRow>\n            </TableBody>\n          </Table>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport type { AccountType, TrialBalanceAccount, TrialBalanceSummary }\n"
    }
  ]
}